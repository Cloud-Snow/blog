<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/blog/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/blog/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/blog/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/blog/images/logo.svg" color="#222">

<link rel="stylesheet" href="/blog/css/main.css">


<link rel="stylesheet" href="/blog/lib/font-awesome/css/all.min.css">
  
  <link rel="stylesheet" href="/blog/lib/animate-css/animate.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"rcore-os.github.io","root":"/blog/","scheme":"Muse","version":"8.0.0-rc.4","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="rcore-os Blog">
<meta property="og:url" content="http://rcore-os.github.io/blog/page/2/index.html">
<meta property="og:site_name" content="rcore-os Blog">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="rcore-os Group">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://rcore-os.github.io/blog/page/2/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>rcore-os Blog</title>
  






  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <main class="main">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader">
        <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
        <span class="toggle-line toggle-line-first"></span>
        <span class="toggle-line toggle-line-middle"></span>
        <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/blog/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">rcore-os Blog</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/blog/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/blog/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/blog/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/blog/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <section class="post-toc-wrap sidebar-panel">
      </section>
      <!--/noindex-->

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">rcore-os Group</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/blog/archives/">
        
          <span class="site-state-item-count">404</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/blog/categories/">
          
        <span class="site-state-item-count">25</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/blog/tags/">
          
        <span class="site-state-item-count">407</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </section>
    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </header>

      
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div id="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


      <div class="main-inner">
        

        <div class="content index posts-expand">
          
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://rcore-os.github.io/blog/2024/06/29/2024-%E6%98%A5%E5%AD%A3%E5%BC%80%E6%BA%90%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AE%AD%E7%BB%83%E8%90%A5%E6%80%BB%E7%BB%93%E6%8A%A5%E5%91%8A-%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5-%E8%8B%A6%E7%93%9C%E5%B0%8F%E4%BB%94/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="rcore-os Group">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="rcore-os Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2024/06/29/2024-%E6%98%A5%E5%AD%A3%E5%BC%80%E6%BA%90%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AE%AD%E7%BB%83%E8%90%A5%E6%80%BB%E7%BB%93%E6%8A%A5%E5%91%8A-%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5-%E8%8B%A6%E7%93%9C%E5%B0%8F%E4%BB%94/" class="post-title-link" itemprop="url">2024 春季开源操作系统训练营总结报告 - 第三阶段 - 周积萍 (苦瓜小仔)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-06-29 22:00:00" itemprop="dateCreated datePublished" datetime="2024-06-29T22:00:00+00:00">2024-06-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-07-02 02:36:28" itemprop="dateModified" datetime="2024-07-02T02:36:28+00:00">2024-07-02</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>继我的训练营<a href="https://rcore-os.cn/blog/2024/04/23/2024-%E6%98%A5%E5%AD%A3%E5%BC%80%E6%BA%90%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AE%AD%E7%BB%83%E8%90%A5%E6%80%BB%E7%BB%93%E6%8A%A5%E5%91%8A1-%E8%8B%A6%E7%93%9C%E5%B0%8F%E4%BB%94/" target="_blank" rel="noopener">第 1-2 阶段总结</a>之后，终于结束了第 3 阶段。</p>
<p>这里的内容与我的幻灯片《<a href="https://docs.qq.com/slide/DTG1vc2FKR2xsYmpL" target="_blank" rel="noopener">阶段 3 学习总结 + 实现 rCore 异步定时器驱动</a>》基本一致。</p>
<p>参加训练营以来的所有笔记，都在 <a href="https://zjp-cn.github.io/os-notes" target="_blank" rel="noopener">https://zjp-cn.github.io/os-notes</a>。</p>
<h1 id="每周任务（均完成）"><a href="#每周任务（均完成）" class="headerlink" title="每周任务（均完成）"></a>每周任务（均完成）</h1><ul>
<li>第 2 周：<a href="https://play.rust-lang.org/?version=stable&mode=debug&edition=2021&gist=404a64695ff36c37b18e4e3d92f849d1" target="_blank" rel="noopener">用户态协程（爬虫）</a></li>
<li>第 3 周：向 embassy 提交修复 Waker unsoundness 的 PR（已合并）<ul>
<li><a href="https://github.com/embassy-rs/embassy/pull/3059" target="_blank" rel="noopener">embassy#3059: use nightly waker_getters APIs</a></li>
<li><a href="https://github.com/embassy-rs/embassy/pull/3069" target="_blank" rel="noopener">embassy#3069: minimize cfg code in task_from_waker</a></li>
</ul>
</li>
<li>第 4-6 周：将 embassy 应用于 rCore 定时器驱动<ul>
<li>仓库地址：<a href="https://gitee.com/ZIP97/rCore-tutorial-code-2024S-embassy" target="_blank" rel="noopener">rCore-tutorial-code-2024S-embassy</a></li>
<li>文档：仓库 README 或者 <a href="https://zjp-cn.github.io/os-notes/rCore-embassy-timer.html" target="_blank" rel="noopener">os-notes/rCore-embassy-timer</a></li>
</ul>
</li>
</ul>
<h1 id="开发日志"><a href="#开发日志" class="headerlink" title="开发日志"></a>开发日志</h1><ul>
<li><a href="https://zjp-cn.github.io/os-notes/async-os-dev-log_rCore-N.html" target="_blank" rel="noopener">rCore-N (共享调度器 fork) 搭建和踩坑</a></li>
<li><a href="https://zjp-cn.github.io/os-notes/cortex-m-quickstart.html" target="_blank" rel="noopener">cortex-m-quickstart 的 qemu 模拟记录</a></li>
<li><a href="https://zjp-cn.github.io/os-notes/embassy-usage.html" target="_blank" rel="noopener">embassy-usage</a>（学习 embassy 时，自己编写的<a href="https://gitee.com/ZIP97/embassy-usage" target="_blank" rel="noopener">示例仓库</a>）</li>
<li><a href="https://zjp-cn.github.io/os-notes/embassy.html" target="_blank" rel="noopener">研究 embassy 库的经验之谈</a> （RA 配置、条件编译、check-cfg）</li>
<li><a href="https://zjp-cn.github.io/os-notes/green-thread.html" target="_blank" rel="noopener">green-thread</a>（整合绿色线程代码到单独的<a href="https://gitee.com/ZIP97/green-thread" target="_blank" rel="noopener">仓库</a>）</li>
</ul>
<h1 id="学习笔记"><a href="#学习笔记" class="headerlink" title="学习笔记"></a>学习笔记</h1><ul>
<li><a href="https://zjp-cn.github.io/os-notes/embassy-task.html" target="_blank" rel="noopener">embassy: TaskStorage</a></li>
<li><a href="https://zjp-cn.github.io/os-notes/embassy-timer.html" target="_blank" rel="noopener">embassy: embassy_time_driver::Driver</a></li>
<li><a href="https://zjp-cn.github.io/os-notes/embassy-sync.html" target="_blank" rel="noopener">embassy: sync</a>：zerocopy_channel (SPSC) 和 MPMC Channel</li>
<li><a href="https://zjp-cn.github.io/os-notes/embassy-integrated-timers.html" target="_blank" rel="noopener">embassy: integrated-timers 和任务机制</a>：任务类别、任务调度与执行、任务的状态与改变、添加和删除任务、任务与 Future</li>
</ul>
<h1 id="其他工作"><a href="#其他工作" class="headerlink" title="其他工作"></a>其他工作</h1><ul>
<li>学习 rCore-N 共享调度器项目代码</li>
<li>学习 embassy std 例子时，使用 Miri 碰到 UB 和 ICE<ul>
<li>报告 ICE 给 Miri：<a href="https://github.com/rust-lang/miri/issues/3647" target="_blank" rel="noopener">ICE due to overflow when using a large timeout with futexes</a></li>
<li>在造成 UB 的 critical-section 仓库下留言，提供更多信息：<a href="https://github.com/rust-embedded/critical-section/pull/46" target="_blank" rel="noopener">Mitigate Miri violation</a></li>
</ul>
</li>
<li>每周线上讨论时准备的 PPT<ul>
<li><a href="https://docs.qq.com/slide/DTE5Ta2FXZ1NjSldN" target="_blank" rel="noopener">第 1 周</a></li>
<li><a href="https://docs.qq.com/slide/DTFNkQ0hwaHp2TkxW" target="_blank" rel="noopener">第 2 周</a></li>
<li><a href="https://docs.qq.com/slide/DTHpYQ05HdGZwWUZv" target="_blank" rel="noopener">第 3 周</a></li>
</ul>
</li>
<li>补充基础知识：反复观看讨论的视频回放，把里面提及的新知识全部查一遍<ul>
<li>【笔记】<a href="https://zjp-cn.github.io/os-notes/terminology.html" target="_blank" rel="noopener">专业名词集锦</a></li>
<li>【笔记】<a href="https://zjp-cn.github.io/os-notes/terminology2.html" target="_blank" rel="noopener">专业名词集锦 2</a></li>
<li>【笔记】<a href="https://zjp-cn.github.io/os-notes/terminology3.html" target="_blank" rel="noopener">专业名词集锦 3</a></li>
</ul>
</li>
</ul>
<h1 id="致谢"><a href="#致谢" class="headerlink" title="致谢"></a>致谢</h1><p>向老师是我遇见的最好的老师！感谢向老师在这 6 周时间里倾囊相授，尤其对我充满了耐心、热情和鼓励。与您所交流的一切，远远大于我在训练营里学习的所有知识，也是我所得到的最具价值的收获。</p>
<p>在最后一周，我其实在笔记本里，用笔写了很多很多页想告诉向老师的话，但最终没有开口。</p>
<p>我是一个很容易受到鼓励而逐渐喜欢一个知识领域的人。十四年前，我向英语老师请教的第一个问题，打开了我对英语的兴趣大门，在之后的八年直到人生再无英语课堂，我一直是英语课堂上最跃跃欲试的学生，也常常从第一节晚自习缠着英语老师请教各种问题，直到晚自习放学而不知疲惫。七年前，我发现自己能够自学编程，随后在参加各种数学建模比赛中，负责编程，在收获名次的喜悦中，发展起对编程的爱好，而编程这个兴趣持续到现在。我只是凭借自己的努力而缓慢地学习着，所以，当向老师您每周热情地给予我宝贵的学习机会，我内心充满了感激。我甚至在第三阶段的前几周里，就不止一次地梦见您成为了我的老师，当梦醒来，我就已经知足了。但即便我有时非常希望请教您，我依然不得不拒绝这些机会：我不想麻烦任何人，尤其不想浪费向老师的时间和精力 —— 费心去教一个操作系统领域之外的人，是不值得的事情；此外，我害怕因为向老师而发展起对这个领域的兴趣，维持现有的兴趣已经让我支付了巨大的机会成本和沉没成本。</p>
<hr>
<p>感谢陶要仲同学将异步运行时放置到时间中断处理函数里面，这是完成向老师所提的第二个步骤的最重要的一环；也谢谢你在最后一周、连续三个晚上倾听我喋喋不休，最终我们愉快地合作成功。</p>
<hr>
<p>感谢操作系统训练营里的每位老师！感谢第三阶段杨杰老师、赵方亮老师对我的帮助。感谢 rCore 教程的作者陈渝老师、吴一凡老师（如果我了解错误或者仍有遗漏，请告诉我 ta 的名字）。rCore 教程是我阅读操作系统领域的第一本书，它带我领略到操作系统环环相扣的精巧设计，是我能够完成第二、三阶段非常重要的基础。</p>
<hr>
<p>感谢全球的、开放的、包容的 Rust 社区！我所有的 Rust 知识来自 Rust 社区，来自我所阅读的每一篇文档、每一个博客、每一条帖子、每一则帮助、每一处讨论……是社区的力量，让我发现了新的兴趣，培养了新的习惯。没有积累充分的 Rust 知识储备，我不可能参加这个训练营，也不可能轻松阅读每一行 rCore、embassy 里的 Rust 代码，更不可能在训练营里与各位结识，最终走到现在。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://rcore-os.github.io/blog/2024/06/29/2024%E6%98%A5%E5%AD%A3%E5%BC%80%E6%BA%90%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AE%AD%E7%BB%83%E8%90%A5%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5%E6%80%BB%E7%BB%93%E6%8A%A5%E5%91%8A-%E9%AD%8F%E9%9D%96%E8%BD%A9/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="rcore-os Group">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="rcore-os Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2024/06/29/2024%E6%98%A5%E5%AD%A3%E5%BC%80%E6%BA%90%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AE%AD%E7%BB%83%E8%90%A5%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5%E6%80%BB%E7%BB%93%E6%8A%A5%E5%91%8A-%E9%AD%8F%E9%9D%96%E8%BD%A9/" class="post-title-link" itemprop="url">2024春季开源操作系统训练营第二阶段总结报告-魏靖轩</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-06-29 21:10:58" itemprop="dateCreated datePublished" datetime="2024-06-29T21:10:58+00:00">2024-06-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-07-02 02:36:28" itemprop="dateModified" datetime="2024-07-02T02:36:28+00:00">2024-07-02</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/2024%E6%98%A5%E5%A4%8F%E5%AD%A3%E5%BC%80%E6%BA%90%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AE%AD%E7%BB%83%E8%90%A5/" itemprop="url" rel="index"><span itemprop="name">2024春夏季开源操作系统训练营</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="第三阶段总结"><a href="#第三阶段总结" class="headerlink" title="第三阶段总结"></a>第三阶段总结</h1><p>第三阶段我参加的是向勇老师的项目6：异步操作系统的实现。</p>
<p>总的来说，6周的项目实训过程中，读了很多代码和文档，做了很多事情，学到了很多的东西。</p>
<p>在参加训练营之前，我对异步的了解其实也就是局限于说我们IO要异步，让出控制权，仅此而已。</p>
<p>但是在训练营中，我真正的接触到了何谓真正的异步，以及如何去实现它，受益匪浅。</p>
<p>同时我也将ArceOS的宏内核版本，将其进行了异步化，使整个内核都使用rust的async和await异步编程实现。</p>
<p>同时它也是无栈协程的切换方式，且对协程采用多栈复用的抢占。</p>
<h1 id="第三阶段成果"><a href="#第三阶段成果" class="headerlink" title="第三阶段成果"></a>第三阶段成果</h1><p>在成果上，实现了对ArceOS家族系的Starry的异步化改造，使用async和await等rust提供的异步编程编写内核，已实现核心主体框架；同时对通用操作系统内核下协程的不合理性做调整，实现内核栈池，通过少量堆栈的复用实现对诸如键盘输入等高优先协程处理的抢占机制。</p>
<p>为后来者留下的东西，首先是代码产出：有充足的代码仓库参考，我将各个小步骤的代码都保存了下来。从原始版本 -&gt; task实现 -&gt; 同步无栈协程与显式执行流 -&gt; 异步无栈协程 -&gt; 多栈复用版本。</p>
<p>同时留下了若干个人的文档心得：考虑到训练营很多同学对从同步到异步的过程一头雾水，其实我本人最开始也是这样的，我个人认为更好的办法是看别人的代码，看看别人是怎么实现了，跟着别人学，先模仿，再谈能不能超越，因此留下文档如下：</p>
<ol>
<li>我个人参考的两个内核的阅读和解析心得（去年OS内核唯二的异步内核）。链接：<a href="https://www.jensei.cn/?p=217" target="_blank" rel="noopener">https://www.jensei.cn/?p=217</a></li>
<li>以Starry为基准的，整个改造过程是如何实现的，包含了从一个ArceOS宏内核（或者说rCore）如何一步步改为无栈异步内核。链接：<a href="https://www.jensenwei.cn/?p=221" target="_blank" rel="noopener">https://www.jensenwei.cn/?p=221</a></li>
<li>我个人对其中一些机制的理解，比如async+await，poll等。链接：<a href="https://www.jensenwei.cn/?p=220" target="_blank" rel="noopener">https://www.jensenwei.cn/?p=220</a></li>
</ol>
<p>当然，更多的中间过程结果在项目六，向老师的文档中有所记录，这里不再列出。</p>
<h1 id="第三阶段感受和体会"><a href="#第三阶段感受和体会" class="headerlink" title="第三阶段感受和体会"></a>第三阶段感受和体会</h1><p>总的来说，第三阶段也算有一定的产出，这么长时间也算没白干，身为一个寄算机人，一切都要落实到代码产出上，光写文档吹牛逼不是一个合格的程序猿。</p>
<p>对我这个异步小白来说，理解和实现异步，再到利用异步的过程，是比较复杂且困难的，而且所面对的是如此大的一个内核，其藕断丝连的耦合性会对改造造成相当大的麻烦。尤其是我们对整个调度和进程管理的部分进行一次彻底的重构，这种挑战相当之大。</p>
<p>但是挑战之大，也是挺过来了，在改造整体框架下，大概前前后后推倒重来了十多次，这也是为什么我那么注重保存每一个小步骤的代码。</p>
<p>总的来说，训练营中我给自己列了一个很高的挑战，也尽力的去完成它了，最后的结果我个人是非常满意的，达到了自己对自己的要求。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://rcore-os.github.io/blog/2024/06/29/2024%E5%BC%80%E6%BA%90%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AE%AD%E7%BB%83%E8%90%A5%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5%E6%80%BB%E7%BB%93%E6%8A%A5%E5%91%8A-%E9%99%B6%E8%A6%81%E4%BB%B2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="rcore-os Group">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="rcore-os Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2024/06/29/2024%E5%BC%80%E6%BA%90%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AE%AD%E7%BB%83%E8%90%A5%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5%E6%80%BB%E7%BB%93%E6%8A%A5%E5%91%8A-%E9%99%B6%E8%A6%81%E4%BB%B2/" class="post-title-link" itemprop="url">2024开源操作系统训练营第二阶段总结-tyz-own</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-06-29 19:16:19" itemprop="dateCreated datePublished" datetime="2024-06-29T19:16:19+00:00">2024-06-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-07-02 02:36:28" itemprop="dateModified" datetime="2024-07-02T02:36:28+00:00">2024-07-02</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/2024%E6%98%A5%E5%A4%8F%E5%AD%A3%E5%BC%80%E6%BA%90%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AE%AD%E7%BB%83%E8%90%A5/" itemprop="url" rel="index"><span itemprop="name">2024春夏季开源操作系统训练营</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="第三阶段总结报告"><a href="#第三阶段总结报告" class="headerlink" title="第三阶段总结报告"></a>第三阶段总结报告</h1><h2 id="相关进度"><a href="#相关进度" class="headerlink" title="相关进度"></a>相关进度</h2><h3 id="前期学习"><a href="#前期学习" class="headerlink" title="前期学习"></a>前期学习</h3><ul>
<li>阅读<a href="https://course.rs/advance/async/future-excuting.html" target="_blank" rel="noopener">《底层探秘: Future 执行与任务调度》</a></li>
<li>阅读<a href="https://stevenbai.top/rust/futures_explained_in_200_lines_of_rust/#%E4%B8%89-rust%E4%B8%AD%E7%9A%84futures" target="_blank" rel="noopener">《200行代码讲透Rust Futures 》</a></li>
<li><a href="https://www.yuque.com/xyong-9fuoz/hg8kgr/xd49izet7xd38gdy" target="_blank" rel="noopener">异步操作系统学术报告</a></li>
<li>编写  <a href="https://github.com/tyz-own/blog/blob/main/%E5%BC%82%E6%AD%A5os/resource/crawler.rs" target="_blank" rel="noopener">用户态异步爬虫</a></li>
<li>阅读<a href="https://embassy.dev/book/" target="_blank" rel="noopener">《Embassy Book》</a></li>
<li>阅读代码<a href="https://github.com/embassy-rs/embassy" target="_blank" rel="noopener">《embassy源码》</a></li>
<li>仓库搭建embassy+rcore并尝试使用<a href="https://github.com/tyz-own/rcore-embassy" target="_blank" rel="noopener">tyz-own/rcore-embassy</a></li>
</ul>
<h3 id="项目实践"><a href="#项目实践" class="headerlink" title="项目实践"></a>项目实践</h3><ul>
<li>在 <code>rcore</code> 中整合 <code>embassy</code>, 首先遇到的问题就是在 <code>executor</code> 代码中里调试程序出错，后来发现了是因为在 <code>poll</code> 之后的一致性锁服务中加入了M态不是S态，将配置文件中的riscv加上一个<code>s-mode</code>的特征属性就好了。</li>
<li>最后一学期在整合 <code>embassy</code> 提供的时钟中断服务时，因为没有找到关于 <code>Driver trait</code> 的具体实现，加上自身实力不济，并未能成功实现相关功能，是周积萍同学帮忙写的，然后我们测试了在单任务，多任务下的时钟中断服务，发现了各种各样的bug，例如任务的阻塞、无限嵌套时钟中断、忽然打出满屏的<code>#</code>号等等（按理来说地址越界是有相应的处理的，不知道这个为什么会直接不处理，可能不是地址越界造成的问题），有些是 <code>embassy</code>循环时的机制问题，有些则还未能解决，但并不妨碍我们去重构timer.rs中的相关定时器代码。</li>
<li>最后在将代码放入 <code>timer.rs</code> 的定时器中并加以重构之后，我们测试了相关用例，发现符合我们的需求，并且能够正常运行。</li>
</ul>
<h2 id="感谢"><a href="#感谢" class="headerlink" title="感谢"></a>感谢</h2><ul>
<li>很感谢周积萍同学帮忙讲解 <code>embassy</code> 相关的运行机制，以及帮我解决 <code>embassy</code> 中的相关问题。</li>
<li>也很感谢向老师每周周会时提出的建议，让我对之后的学习有了更加明确的方向。</li>
<li>感谢夏令营的各位老师和助教们的帮助和支持，同时还提供了一个这么好的平台供我们学习成长。</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://rcore-os.github.io/blog/2024/06/29/2024%E7%A7%8B%E5%86%AC%E5%AD%A3%E5%BC%80%E6%BA%90%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AE%AD%E7%BB%83%E8%90%A5%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5%E6%80%BB%E7%BB%93%E6%8A%A5%E5%91%8A-%E9%83%91%E6%98%B1%E5%8F%AF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="rcore-os Group">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="rcore-os Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2024/06/29/2024%E7%A7%8B%E5%86%AC%E5%AD%A3%E5%BC%80%E6%BA%90%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AE%AD%E7%BB%83%E8%90%A5%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5%E6%80%BB%E7%BB%93%E6%8A%A5%E5%91%8A-%E9%83%91%E6%98%B1%E5%8F%AF/" class="post-title-link" itemprop="url">2024秋冬季开源操作系统训练营第三阶段总结报告_郑昱可</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-06-29 15:33:10" itemprop="dateCreated datePublished" datetime="2024-06-29T15:33:10+00:00">2024-06-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-07-02 02:36:28" itemprop="dateModified" datetime="2024-07-02T02:36:28+00:00">2024-07-02</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/report/" itemprop="url" rel="index"><span itemprop="name">report</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="内容"><a href="#内容" class="headerlink" title="内容"></a>内容</h1><p>三阶段的项目我选择了Rust for Linux驱动开发方向。</p>
<p>具体内容是用Rust重写PL011串口驱动,并能通过跨内核驱动框架，使驱动在arceos和linux运行</p>
<p>这次的项目基于Raspi4b or Raspi3b in Qemu进行开发。</p>
<p>我使用的开发的仓库地址是(R4L_DRV)[<a href="https://github.com/Oveln/R4L_DRV]" target="_blank" rel="noopener">https://github.com/Oveln/R4L_DRV]</a></p>
<h1 id="练习部分"><a href="#练习部分" class="headerlink" title="练习部分"></a>练习部分</h1><h2 id="内容-1"><a href="#内容-1" class="headerlink" title="内容"></a>内容</h2><p>练习部分分三个</p>
<ul>
<li>用Rust for Linux写一个简单的杂项设备驱动，能做到输入和输出</li>
<li>用跨内核驱动框架，实现一个设备驱动，能控制Raspi4b上的某个引脚，从而控制LED的亮灭</li>
</ul>
<h2 id="遇到的困难"><a href="#遇到的困难" class="headerlink" title="遇到的困难"></a>遇到的困难</h2><p>此前我完全没有接触过驱动的编写，对硬件的原理知之甚少。经过很长一段时间的RTFM，以及了解硬件编程相关的知识。</p>
<p>同时对Linux设备驱动相关的内容也进行了比较充足的了解。</p>
<h2 id="收获"><a href="#收获" class="headerlink" title="收获"></a>收获</h2><p>练习部分的收获主要是</p>
<ul>
<li>第一次接触了Linux的设备驱动，对文件树中的/dev/xxx的设备文件有了认知</li>
<li>更加明白了什么叫Every thing is File</li>
<li>稍微看的懂电路原理图了x</li>
<li>对很长的文档的恐惧逐渐消退</li>
</ul>
<h1 id="实战部分-使用Rust重写PL011驱动"><a href="#实战部分-使用Rust重写PL011驱动" class="headerlink" title="实战部分:使用Rust重写PL011驱动"></a>实战部分:使用Rust重写PL011驱动</h1><h2 id="问题一"><a href="#问题一" class="headerlink" title="问题一"></a>问题一</h2><p>串口驱动的内容相较于简单的GPIO繁琐且复杂，需要我进一步的了解Linux的串口子系统tty-uart_driver-uart_port相关的注册关系。</p>
<p>在经过一些努力</p>
<ul>
<li>RTFS</li>
<li>找网上的资料学习（特别感谢野火的文档教程</li>
</ul>
<p>这个问题逐渐的被解决了</p>
<h2 id="问题二"><a href="#问题二" class="headerlink" title="问题二"></a>问题二</h2><p>Rust for Linux经过数年的发展，在某些方面有了完备的抽象。但这次项目所涉及的uart_driver、uart_port、console等结构体没有被支持。</p>
<p>这个问题没什么简单的办法，在Rust for Linux社区中也没有找到好的实现。只能自己做。</p>
<h3 id="如何抽象函数指针"><a href="#如何抽象函数指针" class="headerlink" title="如何抽象函数指针"></a>如何抽象函数指针</h3><p>比如，在uart_port中有很多void*类型的函数指针，如何对这些函数指针进行良好的Rust抽象就成了一大问题。</p>
<p>我在R4L的代码中找到的解决方案是</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ops</span> &#123;</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span>* <span class="title">print_int</span><span class="params">(<span class="keyword">int</span>)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">void</span>* <span class="title">print_char</span><span class="params">(<span class="keyword">char</span>)</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以上代码可以通过Rust进行如下封装</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">struct</span> <span class="title">OperationsVtable</span></span>&lt;T&gt;(marker::PhantomData&lt;T&gt;);</span><br><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">trait</span> <span class="title">Ops</span></span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">print_int</span></span>(x: <span class="built_in">i32</span>);</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">print_char</span></span>(x: <span class="built_in">char</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">impl</span>&lt;T: Ops&gt; OperationsVtable&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">unsafe</span> <span class="keyword">extern</span> <span class="string">"C"</span> <span class="function"><span class="keyword">fn</span> <span class="title">print_int</span></span>(x: c_int) &#123;</span><br><span class="line">        T::print_int(x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">unsafe</span> <span class="keyword">extern</span> <span class="string">"C"</span> <span class="function"><span class="keyword">fn</span> <span class="title">print_char</span></span>(x: c_char) &#123;</span><br><span class="line">        T::print_char(x);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> VTABLE: bindings::ops = bindings::ops &#123;</span><br><span class="line">        print_int: <span class="literal">Some</span>(Self::print_int),</span><br><span class="line">        print_char: <span class="literal">Some</span>(Self::print_char)</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">pub</span>(<span class="keyword">crate</span>) <span class="keyword">unsafe</span> <span class="function"><span class="keyword">fn</span> <span class="title">build</span></span>() -&gt; *<span class="keyword">const</span> bindings::ops &#123;</span><br><span class="line">        &amp;Self::VTABLE <span class="keyword">as</span> *<span class="keyword">const</span> _</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在定义了上面三段后就可以定义一个自己的Ops</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">MyOps</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> Ops <span class="keyword">for</span> MyOps &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 之后想要得到MyOps的对应的C的ops结构体只需要</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> ops = OperationsVtable&lt;MyOps&gt;::build();</span><br></pre></td></tr></table></figure>


<h2 id="现在的成果和收获"><a href="#现在的成果和收获" class="headerlink" title="现在的成果和收获"></a>现在的成果和收获</h2><p>对Linux的C代码中的serial_core.h中的uart_driver和uart_port以及console做了比较完整的抽象。</p>
<p>我也能够比较好的使用Rust中的Pin使数据固定在内存上的某个地方了。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://rcore-os.github.io/blog/2024/06/29/2024%E6%98%A5%E5%BC%80%E6%BA%90%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AE%AD%E7%BB%83%E8%90%A5%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5%E9%A1%B9%E7%9B%AE%E4%B8%80%E6%80%BB%E7%BB%93%E6%8A%A5%E5%91%8A--%E7%AC%A6%E4%BF%8A%E6%9D%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="rcore-os Group">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="rcore-os Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2024/06/29/2024%E6%98%A5%E5%BC%80%E6%BA%90%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AE%AD%E7%BB%83%E8%90%A5%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5%E9%A1%B9%E7%9B%AE%E4%B8%80%E6%80%BB%E7%BB%93%E6%8A%A5%E5%91%8A--%E7%AC%A6%E4%BF%8A%E6%9D%B0/" class="post-title-link" itemprop="url">2024春开源操作系统训练营第三阶段项目一总结报告--符俊杰</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-06-29 04:17:48" itemprop="dateCreated datePublished" datetime="2024-06-29T04:17:48+00:00">2024-06-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-07-02 02:36:28" itemprop="dateModified" datetime="2024-07-02T02:36:28+00:00">2024-07-02</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/report/" itemprop="url" rel="index"><span itemprop="name">report</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="第三阶段总结"><a href="#第三阶段总结" class="headerlink" title="第三阶段总结"></a>第三阶段总结</h3><h4 id="前期实验"><a href="#前期实验" class="headerlink" title="前期实验"></a>前期实验</h4><p>第三阶段前期老师带领我们基于Arceos做了两周的实验</p>
<ul>
<li><strong>练习1：支持彩色打印 println!</strong><br>较为简单，且有多种解法，可以在项目不同的层次进行修改来支持彩色打印</li>
<li><strong>练习2：支持HashMap数据类型</strong><br>在官网找到HashMap的源码然后进行一定增删就可以实现，因为初学rust，有些高级用法很生疏，改起来有点费劲。</li>
<li><strong>练习3：为内存分配器实现新的内存算法</strong><br>我的实现比较粗暴，有些内存空隙直接不要了</li>
<li><strong>练习4：解析dtb并打印</strong><br>在crate.io中有现成的解析dtb的crate，但是需要进行一定修改才能满足任务要求</li>
<li><strong>练习5：抢占式调度算法</strong><br>这个任务比较简单，改一下<code>crates/scheduler/src/fifo.rs</code>就好了</li>
</ul>
<p>第二周的五个实验如下：</p>
<ul>
<li><strong>实验一：从外部加载应用</strong></li>
<li><strong>实验2：把应用拷贝到执行区域并执行</strong></li>
<li><strong>实验3：通过 ABI 调用 ArceOS 功能</strong></li>
<li><strong>实验4：正式在 App 中调用 ABI</strong></li>
<li><strong>实验5：支持内核和应用分离的地址空间及切换</strong></li>
</ul>
<p>对于第二周的五个实验总体来说就是把外部应用APP写入PFLASH中，然后在内核中写一个APP加载器，为APP初始好寄存器后跳转到APP执行，同时支持多地址空间以及给APP传递内核<code>API_TABLE</code>的地址。第二周让我印象深刻的是跳转到APP执行前对寄存器的初始化很重要，如果初始化不到位可能会导致运行APP的时候出现各种错误。同时实验4也让我学到了如何以通过传参的方式支持APP调用内核API。</p>
<p>之后就是进入真正的项目阶段了，项目阶段是在lkmodel上开发，lkmodel相比Arceos我个人感觉难度还是有一定提升，且前两周刚熟悉完Arceos的代码和模块（T_T），一开始还是挺畏难的。不过最后在做的过程中慢慢熟悉lkmodel后也就不那么害怕了。</p>
<h4 id="进入真正的项目阶段"><a href="#进入真正的项目阶段" class="headerlink" title="进入真正的项目阶段"></a>进入真正的项目阶段</h4><h5 id="musl入手"><a href="#musl入手" class="headerlink" title="musl入手"></a>musl入手</h5><p>由于musl编译出来的app系统调用要比glibc简单的多且少得多，因此我先尝试支持用musl-gcc编译的hello_world程序。<br>经历大概如下：</p>
<ul>
<li>支持加载hello_world.bin程序并执行</li>
<li>支持对elf的解析</li>
<li>支持对hello_world.elf程序的执行</li>
</ul>
<h4 id="支持glibc"><a href="#支持glibc" class="headerlink" title="支持glibc"></a>支持glibc</h4><p>要支持glibc要实现和空实现一些syscall，让我印象比较深的是writev_syscall<br>原本lkmodel的writev_syscall实现如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">pub fn writev(fd: usize, iov_array: &amp;[iovec]) -&gt; usize &#123;</span><br><span class="line">    assert!(fd &#x3D;&#x3D; 1 || fd &#x3D;&#x3D; 2);</span><br><span class="line">    for iov in iov_array &#123;</span><br><span class="line">        debug!(&quot;iov: &#123;:#X&#125; &#123;:#X&#125;&quot;, iov.iov_base, iov.iov_len);</span><br><span class="line">        let bytes &#x3D; unsafe &#123; core::slice::from_raw_parts(iov.iov_base as *const _, iov.iov_len) &#125;;</span><br><span class="line">        let s &#x3D; String::from_utf8(bytes.into());</span><br><span class="line">        error!(&quot;&#123;&#125;&quot;, s.unwrap());</span><br><span class="line">    &#125;</span><br><span class="line">    iov_array.len()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>但是运行的时候发现没有输出，于是我简单的在writev里面加了一个<code>early_console::write_bytes(bytes);</code>。但发现输出的时候遇到了奇怪的现象，例如输出一个<code>Hello_world</code>，他会进行多次输出，并且输出的字符个数逐渐减少。如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">修改后：</span><br></pre></td></tr></table></figure>
<p>pub fn writev(fd: usize, iov_array: &amp;[iovec]) -&gt; usize {<br>    assert!(fd == 1 || fd == 2);<br>    let mut total_bytes_written = 0;<br>    for iov in iov_array {<br>        //debug!(“iov: {:#X} {:#X}”, iov.iov_base, iov.iov_len);<br>        let bytes = unsafe { core::slice::from_raw_parts(iov.iov_base as *const _, iov.iov_len) };<br>        let s = String::from_utf8(bytes.into());<br>        early_console::write_bytes(bytes);<br>        total_bytes_written += iov.iov_len;<br>    }<br>    total_bytes_written<br>}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### 发现的问题及解决思路</span><br><span class="line">1. 在支持glibc的时候由于glibc调用了一些task相关的syscall，需要拿到当前的task_sched_info，但是每次都拿不到（None），就很奇怪，明明也进行了task::init()，为什么拿不到呢？后面一直跟踪拿task_sched_info的源码才发现是通过读gp寄存器拿的，即项目中的&#96;&#96;&#96;pub fn gen_read_current_raw(symbol: &amp;Ident, ty: &amp;Type) -&gt; proc_macro2::TokenStream &#96;&#96;&#96;存也是把task_sched_info的地址存在gp寄存器上&#96;&#96;&#96;pub fn gen_write_current_raw(symbol: &amp;Ident, val: &amp;Ident, ty: &amp;Type) -&gt; proc_macro2::TokenStream &#96;&#96;&#96;。然后我就怀疑gp寄存器在app运行时被改变了，于是查看qemu.log，果然一开始就动了gp寄存器。于是我采用一个全局静态变量来存当前的task_sched_info，这样就可以顺利拿到了。</span><br><span class="line">2. 一开始没有清理.bss，导致运行时各种奇怪的问题。其实一开始没清理.bss是因为我在做payload的时候是创建了一个32M的空文件（全0），然后把app.elf文件写进去，我心想写的时候是全0，我就不用清理了吧，但在debug的时候发现利用lkmodel下的elf crate来对app.elf进行解析的时候竟然把.bss那块儿区域写了一些数据，就因为偷了个懒，导致又浪费一大把时间debug。</span><br><span class="line">3. 在支持vfork时，vfork的子进程由于要copy父进程的进入trap_handler时的寄存器信息以正确返回。在子进程返回时发现其trap上下文的sepc寄存器一直是0，且其他寄存器的值也不正常，经过调试发现是copy父进程的trap上下文时出现了问题，最后发现问题如下：</span><br><span class="line">pt_regs_addr()函数（即拿到trap上下地址的函数）原来是</span><br></pre></td></tr></table></figure>
<pre><code>pub fn pt_regs_addr(&amp;self) -&gt; usize {
    self.kstack.as_ref().unwrap().top() - align_down(TRAPFRAME_SIZE, STACK_ALIGN)
}</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">但是由于align_down导致减去的值不是TRAPFRAME_SIZE</span><br><span class="line">但在汇编中却是用self.kstack.as_ref().unwrap().top() 直接减去TRAPFRAME_SIZE</span><br><span class="line">如下：</span><br></pre></td></tr></table></figure>
<p>.Ltrap_entry_s:<br>    addi    sp, sp, -{trapframe_size}<br>    SAVE_REGS 0<br>    mv      a0, sp<br>    auipc   a1, 0          # Load the upper 20 bits of the PC into a1<br>    addi    a1, a1, 12<br>    call    riscv_trap_handler<br>    RESTORE_REGS 0<br>    sret</p>
<p>.Ltrap_entry_u:<br>    addi    sp, sp, -{trapframe_size}<br>    SAVE_REGS 1<br>    mv      a0, sp<br>    li      a1, 1<br>    call    riscv_trap_handler<br>    addi    t0, sp, {trapframe_size}    // put supervisor sp to scratch<br>    csrw    sscratch, t0<br>    RESTORE_REGS 1<br>    sret</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">因此在rust中是用pt_regs_addr()获取trap_frame地址然后进行读写操作是和汇编里面的存储位置不匹配。</span><br><span class="line">4. 不知道是不是因为静态链接的原因，我这边argc,argv,env在栈上的排布和ppt不一样，用ppt的方式排布app拿不到argv</span><br><span class="line">下面是我在其他地方看到的另一种排布方式，用此方式排布app可以正确拿到argv参数</span><br></pre></td></tr></table></figure>
<h2 id="高地址"><a href="#高地址" class="headerlink" title="高地址"></a>高地址</h2><p>  0<br>  …<br>  envp[1]<br>  envp[0]<br>  0<br>  …<br>  argv[1]<br>  argv[0]<br>  argc<br>–<br>低地址</p>
<p>```</p>
<ol start="5">
<li>由于要支持多地址空间，因此我需要给每个app重新分配一个页表，并在这个基础上为app分配内存。同时我为了复用lkmodel下的代码，我采用<code>user_mode_thread</code>来创建一个新的进程，因此我需要对<code>user_mode_thread</code>代码进行修改，最重要的是修改地址空间那块，我需要为app准备一个新的地址空间，而不是和内核共享同一个地址空间。于是我考虑更改mm_copy模块，但后面想到不能直接改这里，因为mm_copy这个函数会被多个模块调用，我改了可能其他模块就跑不通了。于是我决定在<code>user_mode_thread</code>外面为app的task.mm重新赋值（即建立新的地址空间），但神奇的事情发生了，赋值后会导致内核的页表（即之前task.mm指向的区域）被回收（Arc指针计数并不为0），之后为了验证是否是我修改了其他模块导致该问题，于是我重新git clone下来了原仓库并在原仓库基础上进行测试，发现还是会出现相同的问题。最后我通过其他手段绕过了该问题。<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4>这一个月的项目实习使我debug能力又有了提升同时更加深刻的理解了musl-gcc,glib-gcc的区别，同时也更加深刻的了解了Unikernel。同时也跟同学老师们学到了很多东西。</li>
</ol>
<h4 id="仓库链接"><a href="#仓库链接" class="headerlink" title="仓库链接"></a>仓库链接</h4><p><a href="https://github.com/xhyf77/lkmodel/tree/dev" target="_blank" rel="noopener">https://github.com/xhyf77/lkmodel/tree/dev</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://rcore-os.github.io/blog/2024/06/28/2024%E6%98%A5%E5%A4%8F%E5%AD%A3%E5%BC%80%E6%BA%90%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AE%AD%E7%BB%83%E8%90%A53%E9%98%B6%E6%AE%B5%E6%80%BB%E7%BB%93-xuejianxinokok/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="rcore-os Group">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="rcore-os Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2024/06/28/2024%E6%98%A5%E5%A4%8F%E5%AD%A3%E5%BC%80%E6%BA%90%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AE%AD%E7%BB%83%E8%90%A53%E9%98%B6%E6%AE%B5%E6%80%BB%E7%BB%93-xuejianxinokok/" class="post-title-link" itemprop="url">2024春夏季开源操作系统训练营3阶段总结-xuejianxinokok</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-06-28 11:17:04" itemprop="dateCreated datePublished" datetime="2024-06-28T11:17:04+00:00">2024-06-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-07-02 02:36:28" itemprop="dateModified" datetime="2024-07-02T02:36:28+00:00">2024-07-02</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><a href="https://gitee.com/xuejianxinokok/mysqldoc/blob/master/rust/arcos%E9%97%AE%E9%A2%98.md#arceos-lkmodel-%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90" target="_blank" rel="noopener">请转到:2024春夏季开源操作系统训练营3阶段总结-xuejianxinokok</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://rcore-os.github.io/blog/2024/05/31/2024%E5%BC%80%E6%BA%90%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AE%AD%E7%BB%83%E8%90%A5%E7%AC%AC%E4%B8%80%E9%98%B6%E6%AE%B5%E6%80%BB%E7%BB%93-qiuanran/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="rcore-os Group">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="rcore-os Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2024/05/31/2024%E5%BC%80%E6%BA%90%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AE%AD%E7%BB%83%E8%90%A5%E7%AC%AC%E4%B8%80%E9%98%B6%E6%AE%B5%E6%80%BB%E7%BB%93-qiuanran/" class="post-title-link" itemprop="url">2024春夏季训练营第一阶段总结-qiuanran</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-05-31 01:17:02" itemprop="dateCreated datePublished" datetime="2024-05-31T01:17:02+00:00">2024-05-31</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-07-02 02:36:28" itemprop="dateModified" datetime="2024-07-02T02:36:28+00:00">2024-07-02</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>在去年秋天听闻了这个训练营，机缘巧合之下结识了Rust和rcore。 也许是由于rust这门语言入门门槛比较高，加之当时没有其他更modern语言的学习经验，只做完Rustlings就已经打算放弃了。从去年秋天到现在一直在写Rust,也了解了许多系统方面的知识，就打算在这次训练营中弥补一些遗憾。</p>
<h2 id="第一阶段"><a href="#第一阶段" class="headerlink" title="第一阶段"></a>第一阶段</h2><h3 id="心得"><a href="#心得" class="headerlink" title="心得"></a>心得</h3><p>第一阶段更多的是教初学者通过查手册、book或者是问AI来逐渐了解Rust的各种特性，如所有权机制（一个value只能对应一个所有者）、RAII机制（自动回收）、智能指针（个人认为智能指针的学习更多的应该落实于应用场景：即它为什么而存在的问题）、生命周期（我认为它的存在更多的是帮助编译器编译）等，这些是Rust比较有意思的机制，也是大大保障了代码安全性的由来。</p>
<h3 id="体验"><a href="#体验" class="headerlink" title="体验"></a>体验</h3><p>有了去年以来一直积累的Rust经验，做Rustlings倒是非常快了。最后出的十道算法题非常有意思，大大加深了我对于智能指针的认识，虽然都是入门的算法题倒算是个很新奇的体验。</p>
<h3 id="资料"><a href="#资料" class="headerlink" title="资料"></a>资料</h3><p><a href="https://github.com/LearningOS/rust-based-os-comp2024/blob/main/2024-spring-scheduling-1.md" target="_blank" rel="noopener">由训练营给出的学习资料</a>，同时也推荐Stanford的CS110L。 </p>
<h2 id="第二阶段"><a href="#第二阶段" class="headerlink" title="第二阶段"></a>第二阶段</h2><h3 id="学习过程"><a href="#学习过程" class="headerlink" title="学习过程"></a>学习过程</h3><p>rcore这个类Unix内核对于了解各种OS的各种核心内容而言是非常有帮助的，实际上，若不是有了Rust的一些经验，很难理清由理论转换为具体实现的过程。</p>
<p>对于rcore的学习，刚开始我十分痛苦，看着后面的实验要求一时间无计可施，只能由各种已经实现的syscall一个个去trace他们的调用关系，才有了一点点的大致思路。但具体实现起来又有其他的问题，这时候我的目光就放在了具体的数据结构上，需要彻底弄明白每一个数据结构的具体功能、与其他数据结构的关联，才能够说很好的掌握了整个流程。</p>
<h3 id="rcore总结"><a href="#rcore总结" class="headerlink" title="rcore总结"></a>rcore总结</h3><ul>
<li>Chapter1-2：需要关注于环境如何一步步搭建，如何切换特权级</li>
<li>Chapter3：难点在于理解任务切换时候的流程：trap上下文的保存。应用在内核中处理时， 其 Trap 控制流调用__switch函数，这个函数非常重要，里面就是任务的上下文寄存器。</li>
<li>Chapter4：对于我而言，虚拟内存几乎是最难的一个章节了，以至于看到实验要求的时候说注意数据被切分成两个不同的页表中时我甚至不知道它想表达什么，反复观看、查找资料之后才能艰难完成。</li>
<li>Chapter5：关键在于理解有关进程的每一个数据结构，以及它的调度机制，重点需要弄明白suspend_current_and_run_next这个函数以及整个task的工作流程：take_current_task 来取出当前正在执行的任务，修改其进程控制块内的状态变成Running，随后将这个任务放入任务管理器的队尾。接着调用 schedule 函数来触发调度并切换任务。</li>
<li>Chapter6：文件系统相比起前面的章节有些异常庞大了，需要抓住核心抽象以及它的层次结构。</li>
<li>Chapter7：了解进程之间如何通信，关注于各种不同的通信方式。</li>
<li>Chapter8：并发是OS绕不开的一个话题，掌握各种锁+线程的概念对于理解并发有奇效，但其实Rust的很受欢迎的异步并发并没有提及，想来是语言特性而不属于OS教学层面上的。推荐一个了解Rust异步并发非常好的读物：<a href="https://tokio.rs/tokio/tutorial/async" target="_blank" rel="noopener">Async in depth | Tokio - An asynchronous Rust runtime</a></li>
</ul>
<h3 id="一些心得"><a href="#一些心得" class="headerlink" title="一些心得"></a>一些心得</h3><p>我觉得最重要的，也是支撑我艰难走过rcore这道难关的就是一个观念，在南京大学的OS课程上反复强调的：操作系统就是一个应用程序。这也是我在进行每一个lab后最大的感触。在接管了trap之后，所有的一切都是逻辑上的开发，与不同的应用程序没有什么区别。</p>
<h3 id="资料-1"><a href="#资料-1" class="headerlink" title="资料"></a>资料</h3><ul>
<li>南京大学OS课程</li>
<li>MIT6.S081: xv6 book</li>
<li>CSAPP</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://rcore-os.github.io/blog/2024/05/30/2024%E5%BC%80%E6%BA%90%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AE%AD%E7%BB%83%E8%90%A5%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5%E6%80%BB%E7%BB%93-squanchhhhh/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="rcore-os Group">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="rcore-os Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2024/05/30/2024%E5%BC%80%E6%BA%90%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AE%AD%E7%BB%83%E8%90%A5%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5%E6%80%BB%E7%BB%93-squanchhhhh/" class="post-title-link" itemprop="url">2024开源操作系统训练营第二阶段总结-squanchhhhh</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-05-30 15:43:07" itemprop="dateCreated datePublished" datetime="2024-05-30T15:43:07+00:00">2024-05-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-07-02 02:36:28" itemprop="dateModified" datetime="2024-07-02T02:36:28+00:00">2024-07-02</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="1-学习心得"><a href="#1-学习心得" class="headerlink" title="1.学习心得"></a>1.学习心得</h2><pre><code>在参加本次课程之前，我正在做MIT6.081的实验，在谁演的过程中，我发现自己对操作系统的了解还不是特别深刻，于是去b站上寻找相关的视频，无意中发现了rcore的课程，便报名参加了，相比起xv6直接给出完整的代码，这个课程的设计可谓亲切许多，通过由浅入深，由表及里的设计，让学生对操作系统的了解更为深刻。</code></pre><h2 id="2-学习成果"><a href="#2-学习成果" class="headerlink" title="2.学习成果"></a>2.学习成果</h2><h3 id="2-1-gdb"><a href="#2-1-gdb" class="headerlink" title="2.1 gdb"></a>2.1 gdb</h3><pre><code>本次实验的成果之一就是对gdb的了解更加深刻，从页表开始，调试程序就变得困难起来，因为不能像第一个实验那样直接顺序执行代码，在切换程序时，会同时切换程序的页表，刚开始也不知道该怎么调试这样的代码，后来发现gdb可以直接将断点设置为*0x0，由于每个用户程序的开始地址都是*0x0，这样当切换进程的时候，就可以很方便的进入用户空间。</code></pre><h3 id="2-2-makefile"><a href="#2-2-makefile" class="headerlink" title="2.2 makefile"></a>2.2 makefile</h3><pre><code>如果引入本地测试的话，测试程序会修改makefile，这样每次都需要重新编写debug的makefile。</code></pre><h3 id="2-3-进程"><a href="#2-3-进程" class="headerlink" title="2.3 进程"></a>2.3 进程</h3><pre><code>在学习操作系统理论知识的时候，对进程控制块的理解不是很深刻，知道是一个很重要的组件，但是没有见到它的真实面貌，在实验中，为了给操作系统添加各种功能，也是为进程控制块添加了不少字段，理解更为深刻。</code></pre><h2 id="3-总结"><a href="#3-总结" class="headerlink" title="3.总结"></a>3.总结</h2><pre><code>在计算机的学习中，动手往往比理论更加重要，做一个操作系统往往效果比学习操作系统理论要好得多。</code></pre>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://rcore-os.github.io/blog/2024/05/24/2024%E5%BC%80%E6%BA%90%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AE%AD%E7%BB%83%E8%90%A5%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5%E6%80%BB%E7%BB%93-%E9%99%88%E8%BD%BD%E7%86%BA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="rcore-os Group">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="rcore-os Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2024/05/24/2024%E5%BC%80%E6%BA%90%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AE%AD%E7%BB%83%E8%90%A5%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5%E6%80%BB%E7%BB%93-%E9%99%88%E8%BD%BD%E7%86%BA/" class="post-title-link" itemprop="url">2024开源操作系统训练营第二阶段总结-陈载熺</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-05-24 14:21:50" itemprop="dateCreated datePublished" datetime="2024-05-24T14:21:50+00:00">2024-05-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-07-02 02:36:28" itemprop="dateModified" datetime="2024-07-02T02:36:28+00:00">2024-07-02</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="第一阶段"><a href="#第一阶段" class="headerlink" title="第一阶段"></a>第一阶段</h1><h2 id="rustlings"><a href="#rustlings" class="headerlink" title="rustlings"></a>rustlings</h2><p>19号开始，把之前写过的rustlings合并，24号把补充的私货题目写完。</p>
<h2 id="对rust的一些认识"><a href="#对rust的一些认识" class="headerlink" title="对rust的一些认识"></a>对rust的一些认识</h2><h3 id="函数式思想"><a href="#函数式思想" class="headerlink" title="函数式思想"></a>函数式思想</h3><p>使用中用到函数式思想最多的是迭代器。不同于cpp的迭代器，rust的迭代器更“函数式“一点。比如对迭代器的修饰、map、collect等都很方便。根据the book，rust的闭包抽象成本比较低，“零成本”。</p>
<h3 id="外部符号与二进制文件"><a href="#外部符号与二进制文件" class="headerlink" title="外部符号与二进制文件"></a>外部符号与二进制文件</h3><p>补充题中的与Cargo.toml等的联动及外部函数、不混淆函数名宏的使用挺扩展我的认知的。rust提供的相当方便的core的宏（#[repr(c)]等）来控制二进制文件的形式。</p>
<h3 id="所有权和生命周期"><a href="#所有权和生命周期" class="headerlink" title="所有权和生命周期"></a>所有权和生命周期</h3><p>之前一直有些不理解，但是看到了一句话“所有权是释放对象的责任”，感觉懂了一点。</p>
<h3 id="rust的宏"><a href="#rust的宏" class="headerlink" title="rust的宏"></a>rust的宏</h3><p>很多功能，很黑魔法。翻了下宏的小册子，是在AST上替换的，很有趣，期待看到更多它的功能。</p>
<h2 id="其他材料"><a href="#其他材料" class="headerlink" title="其他材料"></a>其他材料</h2><ol>
<li>看了下rCore的发展历史。</li>
<li>riscv特权寄存器的文档。</li>
<li>示例文档中一位学长提到的《深入理解linux内核》中的i386分段部分</li>
</ol>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>初窥门径。感觉rust有很多简洁高效的地方，期待进一步的学习。</p>
<h1 id="第二阶段"><a href="#第二阶段" class="headerlink" title="第二阶段"></a>第二阶段</h1><h2 id="实验时间"><a href="#实验时间" class="headerlink" title="实验时间"></a>实验时间</h2><p>放完51假期，7号开始写lab，属于是开始的比较迟（都看到有答疑了，没有去看），超了ddl。但是想学不嫌晚，还是写份总结。</p>
<h2 id="印象"><a href="#印象" class="headerlink" title="印象"></a>印象</h2><p>总共的5个实验中我印象最深的是fs的实验，让我分开来了Data，Inode，DiskInode，OSInode以及各种数据位图之间的区别，diskinode是存放在硬盘上的索引，inode根据diskinode索引值存在于vfs中的对象，在VFS中本身只持有几个属性。做的时候改了diskInode，加了link，其中对块缓存的读取和写入都是传入函数闭包实现的，很有趣。</p>
<p>还想说下mm的实验，双页表的实现使用恒等映射，将高地址的一定段映射到各个进程及os相同的逻辑地址。这样在切换页表进入内核时，可以得到一个过渡区域来处理上下文。</p>
<p>当然，刚接触ch1和ch2时，读linkld是最初震撼，可惜没有实验，现在有些细节模糊了，还是多做总结。</p>
<h2 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h2><ol>
<li>从代码中得到方法。在实现spawn中，仿照fork和exec的实现来照猫画虎，捏了个spawn(id)-&gt;tcb来，感触挺大，代码是详细的准确的教材。</li>
<li>曳光弹。之前看《程序员修炼之道》时看到的概念，是指开发时优先穿透各个层次直接看到效果。我觉得看代码也可以用这种方式快速把握具体的流程，由功能到达自己熟悉的代码结构。来快速认识代码功能。</li>
<li>互操作。灌了很多汇编、二进制、和rust代码的联动。二进制文件的布局、符号等，原来看csapp了解的悬空的“二进制文件”逐渐有了些实际的感觉。</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://rcore-os.github.io/blog/2024/05/24/2024%E5%BC%80%E6%BA%90%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AE%AD%E7%BB%83%E8%90%A5%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5%E6%80%BB%E7%BB%93-%E5%88%98%E6%A2%93%E9%99%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="rcore-os Group">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="rcore-os Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2024/05/24/2024%E5%BC%80%E6%BA%90%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AE%AD%E7%BB%83%E8%90%A5%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5%E6%80%BB%E7%BB%93-%E5%88%98%E6%A2%93%E9%99%86/" class="post-title-link" itemprop="url">2024开源操作系统训练营第一阶段总结-刘梓陆</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-05-24 10:04:16" itemprop="dateCreated datePublished" datetime="2024-05-24T10:04:16+00:00">2024-05-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-07-02 02:36:28" itemprop="dateModified" datetime="2024-07-02T02:36:28+00:00">2024-07-02</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/report/" itemprop="url" rel="index"><span itemprop="name">report</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="2024-开源操作系统训练营第二阶段总结-刘梓陆"><a href="#2024-开源操作系统训练营第二阶段总结-刘梓陆" class="headerlink" title="2024 开源操作系统训练营第二阶段总结-刘梓陆"></a>2024 开源操作系统训练营第二阶段总结-刘梓陆</h1><ul>
<li><a href="#2024-开源操作系统训练营第二阶段总结-刘梓陆">2024 开源操作系统训练营第二阶段总结-刘梓陆</a><ul>
<li><a href="#写在前面">写在前面</a></li>
<li><a href="#欢迎交流-">欢迎交流;-）</a></li>
<li><a href="#os-大概是个什么东西捏我在完成了这个阶段的任务之后的理解">OS 大概是个什么东西捏？我在完成了这个阶段的任务之后的理解</a><ul>
<li><a href="#os-下面还有一个-sbi">os 下面还有一个 sbi？</a></li>
<li><a href="#毫无疑问就是一个应用程序">毫无疑问就是一个应用程序</a></li>
<li><a href="#通过寄存器和-pc-的指令流">通过寄存器和 pc 的指令流</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h2><p>真是一段很长的旅程啊，怎么说呢，这一阶段的任务我基本上都是“挣扎”着完成的，一开始感觉以我对 Rust 和 OS 的理解，应该此阶段的任务不会非常困难。后来发现还得是“纸上得来终觉浅，绝知此事要躬行”，有些东西在课上学习理论知识和实际使用代码进行实现完全是不一样的感觉，而且怎么说呢，Rust 的运用程度实际上对编写操作系统的帮助也不是特别大，就好像你要和<em>亚里士多德</em>探讨哲学问题，重点是这个哲学问题，而不是<em>古希腊语</em>，当然你得先对古希腊语有一个大致的了解，但是古希腊语本身对理解这个哲学问题是没有什么帮助的。</p>
<p>反正总之由于种种原因，我感觉我在这方面的经验根本就是 0，导致本阶段的任务超出截止时间一周差不多才完成。</p>
<p>但是怎么说呢，就好比是 DND 里面的等级系统一样，在等级为 1 的情况下，升到 2 级所需要的经验值是很少的，所以这个训练营给我的提升感觉也特别大（OS 子职等级），了解到了很多之前根本没有机会接触的知识领域，最重要的，更是加深了我对 os 的理解。</p>
<p>我在第一阶段的总结之中也提到了我非常崇拜 Linux，现在感觉我离他好像又进一步了，感到非常开心！</p>
<h2 id="欢迎交流-）"><a href="#欢迎交流-）" class="headerlink" title="欢迎交流;-）"></a>欢迎交流;-）</h2><p>在写这篇博客时，本人<strong>东北大学</strong>大三在读，前两年东学西学，Rust 就是之一，说实话，在本学期开始时，我实在找不到什么东西来做，准备先买一本《趣读 Linux 源码》来看，感谢我学弟<strong>翊嘉</strong>，是他给我推荐了这个操作系统训练营，这样直接上手操作系统的效果比看书要好太多了，真的十分感谢！</p>
<p>我对 Rust 的理解还是比较少，future、unsafe 的内容更是知之甚少，所以大佬求带！看到我这篇总结报告之中有什么不足也请指出！</p>
<ul>
<li>github ID: <a href="https://github.com/destinyFvcker" target="_blank" rel="noopener">destinyFvcker</a></li>
<li>邮箱：<a href="mailto:&#100;&#x65;&#x73;&#x74;&#105;&#x6e;&#121;&#x66;&#x75;&#110;&#107;&#64;&#x31;&#x36;&#x33;&#x2e;&#x63;&#x6f;&#109;">&#100;&#x65;&#x73;&#x74;&#105;&#x6e;&#121;&#x66;&#x75;&#110;&#107;&#64;&#x31;&#x36;&#x33;&#x2e;&#x63;&#x6f;&#109;</a></li>
<li>微信号：wxid_r3se52q2d4pg22</li>
</ul>
<h2 id="OS-大概是个什么东西捏？我在完成了这个阶段的任务之后的理解"><a href="#OS-大概是个什么东西捏？我在完成了这个阶段的任务之后的理解" class="headerlink" title="OS 大概是个什么东西捏？我在完成了这个阶段的任务之后的理解"></a>OS 大概是个什么东西捏？我在完成了这个阶段的任务之后的理解</h2><p>最近在看 Linus 的自传，他在里面讲了一段关于 OS 的话感觉说得特别好：</p>
<blockquote>
<p>计算机上的所有功能要起作用，都得以操作系统为基础。于是，创造一个操作系统就成了终极挑战。你创造操作系统的时候，相当于给所有在这部电脑上跑的程序创造了一个全新的生存环境—从根本上说，其实就是在制定这个世界的规则：什么事可以接受、可以做，什么事不可以接受、不可以做。其实所有的程序都是在制定规则，只不过操作系统制定的是最根本的规则。创造一个操作系统，就相当于自己创造的一方土地制定宪法，而在电脑上跑的程序则相当于各式各样的普通法律。</p>
</blockquote>
<p>这段话形象地表达了操作系统的功能、作用、以及它对上层应用程序强大的控制能力，但是实际上感觉在实现了一些东西之后，好像也不完全是这样。</p>
<h3 id="os-下面还有一个-sbi？"><a href="#os-下面还有一个-sbi？" class="headerlink" title="os 下面还有一个 sbi？"></a>os 下面还有一个 sbi？</h3><p>原来就是认为是下面这个层级关系：</p>
<ul>
<li>计算机硬件 -&gt; os -&gt; user application</li>
</ul>
<p>但是在使用 RISC-V 实际上应该是这样的！</p>
<ul>
<li>计算机硬件 -&gt; sbi -&gt; os -&gt; user application</li>
</ul>
<p>实际上操作系统也要向下请求 sbi 提供的功能！在本次训练营之中一个比较常用的功能——往屏幕上输出字符就是通过 sbi 完成的。实际上完全不止于此，SBI 还会在计算机启动的时候进行它所负责的环境初始化工作，并将计算机控制权移交给内核，操作系统的关闭也是由 SBI 控制的。</p>
<p>从 RISC-V 特权级架构的视角来看，我们编写的 OS 内核位于 Supervisor 特权级，而 RustSBI 位于 Machine 特权级，也是最高的特权级。</p>
<p>说实话，我对 SBI 的理解就到此为止了，在代码之中，很贴心地向我们提供了 SBI 服务调用的接口，我们直接使用就可以了。</p>
<hr>
<p><strong>这部分我感觉还不是很清楚的内容：</strong><br>SBI 的内容我感觉真的后续还有必要继续学习一下。</p>
<hr>
<h3 id="毫无疑问就是一个应用程序"><a href="#毫无疑问就是一个应用程序" class="headerlink" title="毫无疑问就是一个应用程序"></a>毫无疑问就是一个应用程序</h3><p>在本阶段的相关代码项目之中，除了一些关键的处理 Trap 和上下文切换的逻辑是使用汇编进行编写的之外，其他都是使用 Rust 编写的、和普通的用户应用程序并没有什么不同。</p>
<p>在实现了地址空间之后，基本上就完全停留在逻辑上的开发了，不再关心操作系统的实现细节，实际上我在实现了进程和文件系统的相关功能之后回头一看都感觉地址空间之中的一些实现细节都开始遗忘了。</p>
<hr>
<p><strong>这部分我感觉还不是很清楚的内容：</strong><br>Rust 编译器是如何将这个汇编代码和 Rust 代码链接在一起的？<br>而且在 Rust 之中是如何调用在汇编代码之中定义的过程的？</p>
<hr>
<h3 id="通过寄存器和-pc-的指令流"><a href="#通过寄存器和-pc-的指令流" class="headerlink" title="通过寄存器和 pc 的指令流"></a>通过寄存器和 pc 的指令流</h3><p>而且我发现真的一个应用程序实际上非常简单，就是一堆指令，pc 拿到之后一条条执行，然后会有一个跳转指令跳转到另外一条指令进行执行，然后指令的操作数都是从寄存器拿出来的，线程或者进程实际上就是一个包装了指令流的上下文，在里面进行了一些簿记工作，记录了当前指令进行到了哪里，然后一些相关寄存器的状态。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/blog/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/blog/">1</a><span class="page-number current">2</span><a class="page-number" href="/blog/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/blog/page/41/">41</a><a class="extend next" rel="next" href="/blog/page/3/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



        </div>
        

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">rcore-os Group</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/blog/lib/anime.min.js"></script>

<script src="/blog/js/utils.js"></script>

<script src="/blog/js/motion.js"></script>


<script src="/blog/js/schemes/muse.js"></script>


<script src="/blog/js/next-boot.js"></script>


  















  

  

  

</body>
</html>
