<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/blog/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/blog/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/blog/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/blog/images/logo.svg" color="#222">

<link rel="stylesheet" href="/blog/css/main.css">


<link rel="stylesheet" href="/blog/lib/font-awesome/css/all.min.css">
  
  <link rel="stylesheet" href="/blog/lib/animate-css/animate.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"rcore-os.github.io","root":"/blog/","scheme":"Muse","version":"8.0.0-rc.4","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="rcore-os Blog">
<meta property="og:url" content="http://rcore-os.github.io/blog/page/2/index.html">
<meta property="og:site_name" content="rcore-os Blog">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="rcore-os Group">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://rcore-os.github.io/blog/page/2/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>rcore-os Blog</title>
  






  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <main class="main">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader">
        <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
        <span class="toggle-line toggle-line-first"></span>
        <span class="toggle-line toggle-line-middle"></span>
        <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/blog/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">rcore-os Blog</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/blog/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/blog/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/blog/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/blog/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <section class="post-toc-wrap sidebar-panel">
      </section>
      <!--/noindex-->

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">rcore-os Group</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/blog/archives/">
        
          <span class="site-state-item-count">408</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/blog/categories/">
          
        <span class="site-state-item-count">25</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/blog/tags/">
          
        <span class="site-state-item-count">411</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </section>
    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </header>

      
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div id="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


      <div class="main-inner">
        

        <div class="content index posts-expand">
          
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://rcore-os.github.io/blog/2024/06/29/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5%E6%80%BB%E7%BB%93-xik/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="rcore-os Group">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="rcore-os Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2024/06/29/%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5%E6%80%BB%E7%BB%93-xik/" class="post-title-link" itemprop="url">第三阶段总结-xik</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-06-29 22:12:26" itemprop="dateCreated datePublished" datetime="2024-06-29T22:12:26+00:00">2024-06-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-07-02 02:48:29" itemprop="dateModified" datetime="2024-07-02T02:48:29+00:00">2024-07-02</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/os/" itemprop="url" rel="index"><span itemprop="name">os</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="第三阶段：R4L-amp-跨内核驱动框架"><a href="#第三阶段：R4L-amp-跨内核驱动框架" class="headerlink" title="第三阶段：R4L&amp;跨内核驱动框架"></a>第三阶段：R4L&amp;跨内核驱动框架</h4><p>只完成了前三个练习，后面各种大作业+期末考试没时间完成最后一个练习，还是比较可惜。</p>
<p>整个阶段3下来收获还是挺大的，在学校的操作系统大作业里只写过简单的字符设备驱动，在这里才真正把嵌入式、外设等结合进来。</p>
<ul>
<li>了解了跨内核驱动框架的含义和意义。</li>
<li>了解了linux内核模块，设备树，设备IO(内存映射)等。</li>
<li>阅读树莓派数据手册，完成了跨内核框架pure driver层和adapter层关于bcm2711的gpio驱动编写。</li>
<li>对驱动和嵌入式有了更深入的了解。</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://rcore-os.github.io/blog/2024/06/29/2024-%E6%98%A5%E5%AD%A3%E5%BC%80%E6%BA%90%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AE%AD%E7%BB%83%E8%90%A5%E6%80%BB%E7%BB%93%E6%8A%A5%E5%91%8A-%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5-%E8%8B%A6%E7%93%9C%E5%B0%8F%E4%BB%94/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="rcore-os Group">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="rcore-os Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2024/06/29/2024-%E6%98%A5%E5%AD%A3%E5%BC%80%E6%BA%90%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AE%AD%E7%BB%83%E8%90%A5%E6%80%BB%E7%BB%93%E6%8A%A5%E5%91%8A-%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5-%E8%8B%A6%E7%93%9C%E5%B0%8F%E4%BB%94/" class="post-title-link" itemprop="url">2024 春季开源操作系统训练营总结报告 - 第三阶段 - 周积萍 (苦瓜小仔)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-06-29 22:00:00" itemprop="dateCreated datePublished" datetime="2024-06-29T22:00:00+00:00">2024-06-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-07-02 02:48:29" itemprop="dateModified" datetime="2024-07-02T02:48:29+00:00">2024-07-02</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>继我的训练营<a href="https://rcore-os.cn/blog/2024/04/23/2024-%E6%98%A5%E5%AD%A3%E5%BC%80%E6%BA%90%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AE%AD%E7%BB%83%E8%90%A5%E6%80%BB%E7%BB%93%E6%8A%A5%E5%91%8A1-%E8%8B%A6%E7%93%9C%E5%B0%8F%E4%BB%94/" target="_blank" rel="noopener">第 1-2 阶段总结</a>之后，终于结束了第 3 阶段。</p>
<p>这里的内容与我的幻灯片《<a href="https://docs.qq.com/slide/DTG1vc2FKR2xsYmpL" target="_blank" rel="noopener">阶段 3 学习总结 + 实现 rCore 异步定时器驱动</a>》基本一致。</p>
<p>参加训练营以来的所有笔记，都在 <a href="https://zjp-cn.github.io/os-notes" target="_blank" rel="noopener">https://zjp-cn.github.io/os-notes</a>。</p>
<h1 id="每周任务（均完成）"><a href="#每周任务（均完成）" class="headerlink" title="每周任务（均完成）"></a>每周任务（均完成）</h1><ul>
<li>第 2 周：<a href="https://play.rust-lang.org/?version=stable&mode=debug&edition=2021&gist=404a64695ff36c37b18e4e3d92f849d1" target="_blank" rel="noopener">用户态协程（爬虫）</a></li>
<li>第 3 周：向 embassy 提交修复 Waker unsoundness 的 PR（已合并）<ul>
<li><a href="https://github.com/embassy-rs/embassy/pull/3059" target="_blank" rel="noopener">embassy#3059: use nightly waker_getters APIs</a></li>
<li><a href="https://github.com/embassy-rs/embassy/pull/3069" target="_blank" rel="noopener">embassy#3069: minimize cfg code in task_from_waker</a></li>
</ul>
</li>
<li>第 4-6 周：将 embassy 应用于 rCore 定时器驱动<ul>
<li>仓库地址：<a href="https://gitee.com/ZIP97/rCore-tutorial-code-2024S-embassy" target="_blank" rel="noopener">rCore-tutorial-code-2024S-embassy</a></li>
<li>文档：仓库 README 或者 <a href="https://zjp-cn.github.io/os-notes/rCore-embassy-timer.html" target="_blank" rel="noopener">os-notes/rCore-embassy-timer</a></li>
</ul>
</li>
</ul>
<h1 id="开发日志"><a href="#开发日志" class="headerlink" title="开发日志"></a>开发日志</h1><ul>
<li><a href="https://zjp-cn.github.io/os-notes/async-os-dev-log_rCore-N.html" target="_blank" rel="noopener">rCore-N (共享调度器 fork) 搭建和踩坑</a></li>
<li><a href="https://zjp-cn.github.io/os-notes/cortex-m-quickstart.html" target="_blank" rel="noopener">cortex-m-quickstart 的 qemu 模拟记录</a></li>
<li><a href="https://zjp-cn.github.io/os-notes/embassy-usage.html" target="_blank" rel="noopener">embassy-usage</a>（学习 embassy 时，自己编写的<a href="https://gitee.com/ZIP97/embassy-usage" target="_blank" rel="noopener">示例仓库</a>）</li>
<li><a href="https://zjp-cn.github.io/os-notes/embassy.html" target="_blank" rel="noopener">研究 embassy 库的经验之谈</a> （RA 配置、条件编译、check-cfg）</li>
<li><a href="https://zjp-cn.github.io/os-notes/green-thread.html" target="_blank" rel="noopener">green-thread</a>（整合绿色线程代码到单独的<a href="https://gitee.com/ZIP97/green-thread" target="_blank" rel="noopener">仓库</a>）</li>
</ul>
<h1 id="学习笔记"><a href="#学习笔记" class="headerlink" title="学习笔记"></a>学习笔记</h1><ul>
<li><a href="https://zjp-cn.github.io/os-notes/embassy-task.html" target="_blank" rel="noopener">embassy: TaskStorage</a></li>
<li><a href="https://zjp-cn.github.io/os-notes/embassy-timer.html" target="_blank" rel="noopener">embassy: embassy_time_driver::Driver</a></li>
<li><a href="https://zjp-cn.github.io/os-notes/embassy-sync.html" target="_blank" rel="noopener">embassy: sync</a>：zerocopy_channel (SPSC) 和 MPMC Channel</li>
<li><a href="https://zjp-cn.github.io/os-notes/embassy-integrated-timers.html" target="_blank" rel="noopener">embassy: integrated-timers 和任务机制</a>：任务类别、任务调度与执行、任务的状态与改变、添加和删除任务、任务与 Future</li>
</ul>
<h1 id="其他工作"><a href="#其他工作" class="headerlink" title="其他工作"></a>其他工作</h1><ul>
<li>学习 rCore-N 共享调度器项目代码</li>
<li>学习 embassy std 例子时，使用 Miri 碰到 UB 和 ICE<ul>
<li>报告 ICE 给 Miri：<a href="https://github.com/rust-lang/miri/issues/3647" target="_blank" rel="noopener">ICE due to overflow when using a large timeout with futexes</a></li>
<li>在造成 UB 的 critical-section 仓库下留言，提供更多信息：<a href="https://github.com/rust-embedded/critical-section/pull/46" target="_blank" rel="noopener">Mitigate Miri violation</a></li>
</ul>
</li>
<li>每周线上讨论时准备的 PPT<ul>
<li><a href="https://docs.qq.com/slide/DTE5Ta2FXZ1NjSldN" target="_blank" rel="noopener">第 1 周</a></li>
<li><a href="https://docs.qq.com/slide/DTFNkQ0hwaHp2TkxW" target="_blank" rel="noopener">第 2 周</a></li>
<li><a href="https://docs.qq.com/slide/DTHpYQ05HdGZwWUZv" target="_blank" rel="noopener">第 3 周</a></li>
</ul>
</li>
<li>补充基础知识：反复观看讨论的视频回放，把里面提及的新知识全部查一遍<ul>
<li>【笔记】<a href="https://zjp-cn.github.io/os-notes/terminology.html" target="_blank" rel="noopener">专业名词集锦</a></li>
<li>【笔记】<a href="https://zjp-cn.github.io/os-notes/terminology2.html" target="_blank" rel="noopener">专业名词集锦 2</a></li>
<li>【笔记】<a href="https://zjp-cn.github.io/os-notes/terminology3.html" target="_blank" rel="noopener">专业名词集锦 3</a></li>
</ul>
</li>
</ul>
<h1 id="致谢"><a href="#致谢" class="headerlink" title="致谢"></a>致谢</h1><p>向老师是我遇见的最好的老师！感谢向老师在这 6 周时间里倾囊相授，尤其对我充满了耐心、热情和鼓励。与您所交流的一切，远远大于我在训练营里学习的所有知识，也是我所得到的最具价值的收获。</p>
<p>在最后一周，我其实在笔记本里，用笔写了很多很多页想告诉向老师的话，但最终没有开口。</p>
<p>我是一个很容易受到鼓励而逐渐喜欢一个知识领域的人。十四年前，我向英语老师请教的第一个问题，打开了我对英语的兴趣大门，在之后的八年直到人生再无英语课堂，我一直是英语课堂上最跃跃欲试的学生，也常常从第一节晚自习缠着英语老师请教各种问题，直到晚自习放学而不知疲惫。七年前，我发现自己能够自学编程，随后在参加各种数学建模比赛中，负责编程，在收获名次的喜悦中，发展起对编程的爱好，而编程这个兴趣持续到现在。我只是凭借自己的努力而缓慢地学习着，所以，当向老师您每周热情地给予我宝贵的学习机会，我内心充满了感激。我甚至在第三阶段的前几周里，就不止一次地梦见您成为了我的老师，当梦醒来，我就已经知足了。但即便我有时非常希望请教您，我依然不得不拒绝这些机会：我不想麻烦任何人，尤其不想浪费向老师的时间和精力 —— 费心去教一个操作系统领域之外的人，是不值得的事情；此外，我害怕因为向老师而发展起对这个领域的兴趣，维持现有的兴趣已经让我支付了巨大的机会成本和沉没成本。</p>
<hr>
<p>感谢陶要仲同学将异步运行时放置到时间中断处理函数里面，这是完成向老师所提的第二个步骤的最重要的一环；也谢谢你在最后一周、连续三个晚上倾听我喋喋不休，最终我们愉快地合作成功。</p>
<hr>
<p>感谢操作系统训练营里的每位老师！感谢第三阶段杨杰老师、赵方亮老师对我的帮助。感谢 rCore 教程的作者陈渝老师、吴一凡老师（如果我了解错误或者仍有遗漏，请告诉我 ta 的名字）。rCore 教程是我阅读操作系统领域的第一本书，它带我领略到操作系统环环相扣的精巧设计，是我能够完成第二、三阶段非常重要的基础。</p>
<hr>
<p>感谢全球的、开放的、包容的 Rust 社区！我所有的 Rust 知识来自 Rust 社区，来自我所阅读的每一篇文档、每一个博客、每一条帖子、每一则帮助、每一处讨论……是社区的力量，让我发现了新的兴趣，培养了新的习惯。没有积累充分的 Rust 知识储备，我不可能参加这个训练营，也不可能轻松阅读每一行 rCore、embassy 里的 Rust 代码，更不可能在训练营里与各位结识，最终走到现在。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://rcore-os.github.io/blog/2024/06/29/2024%E6%98%A5%E5%AD%A3%E5%BC%80%E6%BA%90%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AE%AD%E7%BB%83%E8%90%A5%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5%E6%80%BB%E7%BB%93%E6%8A%A5%E5%91%8A-%E9%AD%8F%E9%9D%96%E8%BD%A9/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="rcore-os Group">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="rcore-os Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2024/06/29/2024%E6%98%A5%E5%AD%A3%E5%BC%80%E6%BA%90%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AE%AD%E7%BB%83%E8%90%A5%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5%E6%80%BB%E7%BB%93%E6%8A%A5%E5%91%8A-%E9%AD%8F%E9%9D%96%E8%BD%A9/" class="post-title-link" itemprop="url">2024春季开源操作系统训练营第二阶段总结报告-魏靖轩</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-06-29 21:10:58" itemprop="dateCreated datePublished" datetime="2024-06-29T21:10:58+00:00">2024-06-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-07-02 02:48:29" itemprop="dateModified" datetime="2024-07-02T02:48:29+00:00">2024-07-02</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/2024%E6%98%A5%E5%A4%8F%E5%AD%A3%E5%BC%80%E6%BA%90%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AE%AD%E7%BB%83%E8%90%A5/" itemprop="url" rel="index"><span itemprop="name">2024春夏季开源操作系统训练营</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="第三阶段总结"><a href="#第三阶段总结" class="headerlink" title="第三阶段总结"></a>第三阶段总结</h1><p>第三阶段我参加的是向勇老师的项目6：异步操作系统的实现。</p>
<p>总的来说，6周的项目实训过程中，读了很多代码和文档，做了很多事情，学到了很多的东西。</p>
<p>在参加训练营之前，我对异步的了解其实也就是局限于说我们IO要异步，让出控制权，仅此而已。</p>
<p>但是在训练营中，我真正的接触到了何谓真正的异步，以及如何去实现它，受益匪浅。</p>
<p>同时我也将ArceOS的宏内核版本，将其进行了异步化，使整个内核都使用rust的async和await异步编程实现。</p>
<p>同时它也是无栈协程的切换方式，且对协程采用多栈复用的抢占。</p>
<h1 id="第三阶段成果"><a href="#第三阶段成果" class="headerlink" title="第三阶段成果"></a>第三阶段成果</h1><p>在成果上，实现了对ArceOS家族系的Starry的异步化改造，使用async和await等rust提供的异步编程编写内核，已实现核心主体框架；同时对通用操作系统内核下协程的不合理性做调整，实现内核栈池，通过少量堆栈的复用实现对诸如键盘输入等高优先协程处理的抢占机制。</p>
<p>为后来者留下的东西，首先是代码产出：有充足的代码仓库参考，我将各个小步骤的代码都保存了下来。从原始版本 -&gt; task实现 -&gt; 同步无栈协程与显式执行流 -&gt; 异步无栈协程 -&gt; 多栈复用版本。</p>
<p>同时留下了若干个人的文档心得：考虑到训练营很多同学对从同步到异步的过程一头雾水，其实我本人最开始也是这样的，我个人认为更好的办法是看别人的代码，看看别人是怎么实现了，跟着别人学，先模仿，再谈能不能超越，因此留下文档如下：</p>
<ol>
<li>我个人参考的两个内核的阅读和解析心得（去年OS内核唯二的异步内核）。链接：<a href="https://www.jensei.cn/?p=217" target="_blank" rel="noopener">https://www.jensei.cn/?p=217</a></li>
<li>以Starry为基准的，整个改造过程是如何实现的，包含了从一个ArceOS宏内核（或者说rCore）如何一步步改为无栈异步内核。链接：<a href="https://www.jensenwei.cn/?p=221" target="_blank" rel="noopener">https://www.jensenwei.cn/?p=221</a></li>
<li>我个人对其中一些机制的理解，比如async+await，poll等。链接：<a href="https://www.jensenwei.cn/?p=220" target="_blank" rel="noopener">https://www.jensenwei.cn/?p=220</a></li>
</ol>
<p>当然，更多的中间过程结果在项目六，向老师的文档中有所记录，这里不再列出。</p>
<h1 id="第三阶段感受和体会"><a href="#第三阶段感受和体会" class="headerlink" title="第三阶段感受和体会"></a>第三阶段感受和体会</h1><p>总的来说，第三阶段也算有一定的产出，这么长时间也算没白干，身为一个寄算机人，一切都要落实到代码产出上，光写文档吹牛逼不是一个合格的程序猿。</p>
<p>对我这个异步小白来说，理解和实现异步，再到利用异步的过程，是比较复杂且困难的，而且所面对的是如此大的一个内核，其藕断丝连的耦合性会对改造造成相当大的麻烦。尤其是我们对整个调度和进程管理的部分进行一次彻底的重构，这种挑战相当之大。</p>
<p>但是挑战之大，也是挺过来了，在改造整体框架下，大概前前后后推倒重来了十多次，这也是为什么我那么注重保存每一个小步骤的代码。</p>
<p>总的来说，训练营中我给自己列了一个很高的挑战，也尽力的去完成它了，最后的结果我个人是非常满意的，达到了自己对自己的要求。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://rcore-os.github.io/blog/2024/06/29/2024%E5%BC%80%E6%BA%90%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AE%AD%E7%BB%83%E8%90%A5%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5%E6%80%BB%E7%BB%93%E6%8A%A5%E5%91%8A-%E9%99%B6%E8%A6%81%E4%BB%B2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="rcore-os Group">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="rcore-os Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2024/06/29/2024%E5%BC%80%E6%BA%90%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AE%AD%E7%BB%83%E8%90%A5%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5%E6%80%BB%E7%BB%93%E6%8A%A5%E5%91%8A-%E9%99%B6%E8%A6%81%E4%BB%B2/" class="post-title-link" itemprop="url">2024开源操作系统训练营第二阶段总结-tyz-own</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-06-29 19:16:19" itemprop="dateCreated datePublished" datetime="2024-06-29T19:16:19+00:00">2024-06-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-07-02 02:48:29" itemprop="dateModified" datetime="2024-07-02T02:48:29+00:00">2024-07-02</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/2024%E6%98%A5%E5%A4%8F%E5%AD%A3%E5%BC%80%E6%BA%90%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AE%AD%E7%BB%83%E8%90%A5/" itemprop="url" rel="index"><span itemprop="name">2024春夏季开源操作系统训练营</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="第三阶段总结报告"><a href="#第三阶段总结报告" class="headerlink" title="第三阶段总结报告"></a>第三阶段总结报告</h1><h2 id="相关进度"><a href="#相关进度" class="headerlink" title="相关进度"></a>相关进度</h2><h3 id="前期学习"><a href="#前期学习" class="headerlink" title="前期学习"></a>前期学习</h3><ul>
<li>阅读<a href="https://course.rs/advance/async/future-excuting.html" target="_blank" rel="noopener">《底层探秘: Future 执行与任务调度》</a></li>
<li>阅读<a href="https://stevenbai.top/rust/futures_explained_in_200_lines_of_rust/#%E4%B8%89-rust%E4%B8%AD%E7%9A%84futures" target="_blank" rel="noopener">《200行代码讲透Rust Futures 》</a></li>
<li><a href="https://www.yuque.com/xyong-9fuoz/hg8kgr/xd49izet7xd38gdy" target="_blank" rel="noopener">异步操作系统学术报告</a></li>
<li>编写  <a href="https://github.com/tyz-own/blog/blob/main/%E5%BC%82%E6%AD%A5os/resource/crawler.rs" target="_blank" rel="noopener">用户态异步爬虫</a></li>
<li>阅读<a href="https://embassy.dev/book/" target="_blank" rel="noopener">《Embassy Book》</a></li>
<li>阅读代码<a href="https://github.com/embassy-rs/embassy" target="_blank" rel="noopener">《embassy源码》</a></li>
<li>仓库搭建embassy+rcore并尝试使用<a href="https://github.com/tyz-own/rcore-embassy" target="_blank" rel="noopener">tyz-own/rcore-embassy</a></li>
</ul>
<h3 id="项目实践"><a href="#项目实践" class="headerlink" title="项目实践"></a>项目实践</h3><ul>
<li>在 <code>rcore</code> 中整合 <code>embassy</code>, 首先遇到的问题就是在 <code>executor</code> 代码中里调试程序出错，后来发现了是因为在 <code>poll</code> 之后的一致性锁服务中加入了M态不是S态，将配置文件中的riscv加上一个<code>s-mode</code>的特征属性就好了。</li>
<li>最后一学期在整合 <code>embassy</code> 提供的时钟中断服务时，因为没有找到关于 <code>Driver trait</code> 的具体实现，加上自身实力不济，并未能成功实现相关功能，是周积萍同学帮忙写的，然后我们测试了在单任务，多任务下的时钟中断服务，发现了各种各样的bug，例如任务的阻塞、无限嵌套时钟中断、忽然打出满屏的<code>#</code>号等等（按理来说地址越界是有相应的处理的，不知道这个为什么会直接不处理，可能不是地址越界造成的问题），有些是 <code>embassy</code>循环时的机制问题，有些则还未能解决，但并不妨碍我们去重构timer.rs中的相关定时器代码。</li>
<li>最后在将代码放入 <code>timer.rs</code> 的定时器中并加以重构之后，我们测试了相关用例，发现符合我们的需求，并且能够正常运行。</li>
</ul>
<h2 id="感谢"><a href="#感谢" class="headerlink" title="感谢"></a>感谢</h2><ul>
<li>很感谢周积萍同学帮忙讲解 <code>embassy</code> 相关的运行机制，以及帮我解决 <code>embassy</code> 中的相关问题。</li>
<li>也很感谢向老师每周周会时提出的建议，让我对之后的学习有了更加明确的方向。</li>
<li>感谢夏令营的各位老师和助教们的帮助和支持，同时还提供了一个这么好的平台供我们学习成长。</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://rcore-os.github.io/blog/2024/06/29/stage3-async-Rust-blog/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="rcore-os Group">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="rcore-os Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2024/06/29/stage3-async-Rust-blog/" class="post-title-link" itemprop="url"><stage3 async Rust blog></a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-06-29 17:52:28" itemprop="dateCreated datePublished" datetime="2024-06-29T17:52:28+00:00">2024-06-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-07-02 02:48:29" itemprop="dateModified" datetime="2024-07-02T02:48:29+00:00">2024-07-02</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="第三阶段总结报告"><a href="#第三阶段总结报告" class="headerlink" title="第三阶段总结报告"></a>第三阶段总结报告</h2><p>没想到为期40天的第三阶段这么快就结束了。现在回想一下这四十天几乎每天都在准备考试和参加训练营两个任务之间时间片轮转。但是很庆幸我还是走到了训练营的尾声。</p>
<p>在第三阶段的项目六：基于协程异步机制的操作系统/驱动中，我了解到了我之前只是略有耳闻的<strong>异步</strong>，收获到了很多新知识。</p>
<p>首先我先阅读了《200行代码讲透RUST FUTURES》。在这里我又接触到了许多的新概念：绿色线程、Future、执行器、唤醒器。。。现在回想，看的过程实在是非常折磨，不仅要重新回顾本就不扎实的Rust语法，还要把多线程多协程带来的混乱执行流捋清楚。但是当我把它看完了之后，我才豁然开朗，我才明白Executor、Waker、Reactor、Future是如何协同工作以提高计算机的使用效率的。这为我后续阅读Embassy以及完成最终的成果打下了坚实的理论基础。</p>
<p>在《200行代码讲透RUST FUTURES》提供的理论知识的加持下，我进一步阅读了《Embassy Book》。当回到我最熟悉的领域时，总是让人心旷神怡。在阅读《Embassy Book》的全过程中，我并没有遇到太多的障碍（可能这就是专业对口的优势吧），但是我却无时无刻不在感叹Embassy作者对Rust语言的了解程度、他对丑陋的硬件近乎完美的封装以及Embassy向用户提供的友好接口。这让我觉得Embassy好像并不是一个嵌入式运行时库，而更像是一个开销更低的操作系统。</p>
<p>接下来就到了我觉得很有意义的部分。在这一小阶段，我对Embassy源码进行了逐步的调试，尝试理解Embassy的执行流。在Embassy中，有许多宏。Embassy的作者通过这些宏能够暴露给使用者干净、高效的接口，但是这对于我这种初学Rust，并且想理解Embassy执行流的人而言无疑是令人厌烦的。因为它隐藏了太多协程的细节（Rust语法对我而言也是很大的问题），所以我只能从头开始对Embassy源码进行调试。通过调试工具的帮助，我揭开了Embassy神秘的面纱：从创建执行器，到创建协程池；从创建主任务，到协程的不断循环执行。在此时我才真正领悟了Embassy的强大之处。</p>
<p>终于到了coding部分。我与我的队友一起分工合作，成功使用Rust重构了uC/OS II的线程调度模块，并在uC/OS II的线程支持下应用了Embassy的协程机制。这使得Embassy的执行器对MCU不在是独占的，而是可以基于线程的调度算法进行轮转。并且在线程的支持下实现协程，进一步提高了我们的系统的并发度。而且有了线程的调度机制，我们也可以实现不同线程的协程在任意点切换。</p>
<p>现在回想我在阶段三中完成的任务我才发现这些内容是多么地有意义。我了解到了Rust中的协程的实现机制，也了解到了Rust协程的一个实际应用——Embassy，最终我基于这些理论知识成功将Rust的协程使用起来，让我基本了解了一个能有效提高计算机系统性能的“秘籍“。</p>
<p>三阶段固然有意义，但是如果没有他人的帮助，我绝对坚持不到现在。</p>
<p>首先需要感谢我的队友。从三阶段一开始，我们就一直在交流关于Rust Future的各种细节。而到了调试Embassy的部分以及后面的coding，我们也都紧密配合。在调试Embassy的部分，如果没有他的学习成果，我很有可能就会被Embassy高级的Rust语法劝退；在coding部分，如果没有我们共同的努力，我们肯定不会在这么短的时间内使用一个我们都不熟悉的Rust重构一个操作系统的灵魂——线程调度模块，并且在这个基础上使用Embassy的协程机制。</p>
<p>最后还需要感谢向勇老师。在向勇老师的悉心指导下，我和我的队友明确了我们将来的目标。我们希望在堆栈池的支持下，实现线程内部的协程抢占。并且在这个基础上进一步完善我们在阶段三产出的阶段性成果，并将其应用在我们的四轴飞行器中。</p>
<p>再次回顾我的阶段三全过程，虽然我做事情不多，但是我仍收获颇丰。我相信不紧不慢依旧能走向未来。希望我今后也能保持着对异步、对Rust、对OS的满腔热爱，笃行不辍，履践致远。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://rcore-os.github.io/blog/2024/06/29/2024%E7%A7%8B%E5%86%AC%E5%AD%A3%E5%BC%80%E6%BA%90%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AE%AD%E7%BB%83%E8%90%A5%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5%E6%80%BB%E7%BB%93%E6%8A%A5%E5%91%8A-%E9%83%91%E6%98%B1%E5%8F%AF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="rcore-os Group">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="rcore-os Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2024/06/29/2024%E7%A7%8B%E5%86%AC%E5%AD%A3%E5%BC%80%E6%BA%90%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AE%AD%E7%BB%83%E8%90%A5%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5%E6%80%BB%E7%BB%93%E6%8A%A5%E5%91%8A-%E9%83%91%E6%98%B1%E5%8F%AF/" class="post-title-link" itemprop="url">2024秋冬季开源操作系统训练营第三阶段总结报告_郑昱可</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-06-29 15:33:10" itemprop="dateCreated datePublished" datetime="2024-06-29T15:33:10+00:00">2024-06-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-07-02 02:48:29" itemprop="dateModified" datetime="2024-07-02T02:48:29+00:00">2024-07-02</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/report/" itemprop="url" rel="index"><span itemprop="name">report</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="内容"><a href="#内容" class="headerlink" title="内容"></a>内容</h1><p>三阶段的项目我选择了Rust for Linux驱动开发方向。</p>
<p>具体内容是用Rust重写PL011串口驱动,并能通过跨内核驱动框架，使驱动在arceos和linux运行</p>
<p>这次的项目基于Raspi4b or Raspi3b in Qemu进行开发。</p>
<p>我使用的开发的仓库地址是(R4L_DRV)[<a href="https://github.com/Oveln/R4L_DRV]" target="_blank" rel="noopener">https://github.com/Oveln/R4L_DRV]</a></p>
<h1 id="练习部分"><a href="#练习部分" class="headerlink" title="练习部分"></a>练习部分</h1><h2 id="内容-1"><a href="#内容-1" class="headerlink" title="内容"></a>内容</h2><p>练习部分分三个</p>
<ul>
<li>用Rust for Linux写一个简单的杂项设备驱动，能做到输入和输出</li>
<li>用跨内核驱动框架，实现一个设备驱动，能控制Raspi4b上的某个引脚，从而控制LED的亮灭</li>
</ul>
<h2 id="遇到的困难"><a href="#遇到的困难" class="headerlink" title="遇到的困难"></a>遇到的困难</h2><p>此前我完全没有接触过驱动的编写，对硬件的原理知之甚少。经过很长一段时间的RTFM，以及了解硬件编程相关的知识。</p>
<p>同时对Linux设备驱动相关的内容也进行了比较充足的了解。</p>
<h2 id="收获"><a href="#收获" class="headerlink" title="收获"></a>收获</h2><p>练习部分的收获主要是</p>
<ul>
<li>第一次接触了Linux的设备驱动，对文件树中的/dev/xxx的设备文件有了认知</li>
<li>更加明白了什么叫Every thing is File</li>
<li>稍微看的懂电路原理图了x</li>
<li>对很长的文档的恐惧逐渐消退</li>
</ul>
<h1 id="实战部分-使用Rust重写PL011驱动"><a href="#实战部分-使用Rust重写PL011驱动" class="headerlink" title="实战部分:使用Rust重写PL011驱动"></a>实战部分:使用Rust重写PL011驱动</h1><h2 id="问题一"><a href="#问题一" class="headerlink" title="问题一"></a>问题一</h2><p>串口驱动的内容相较于简单的GPIO繁琐且复杂，需要我进一步的了解Linux的串口子系统tty-uart_driver-uart_port相关的注册关系。</p>
<p>在经过一些努力</p>
<ul>
<li>RTFS</li>
<li>找网上的资料学习（特别感谢野火的文档教程</li>
</ul>
<p>这个问题逐渐的被解决了</p>
<h2 id="问题二"><a href="#问题二" class="headerlink" title="问题二"></a>问题二</h2><p>Rust for Linux经过数年的发展，在某些方面有了完备的抽象。但这次项目所涉及的uart_driver、uart_port、console等结构体没有被支持。</p>
<p>这个问题没什么简单的办法，在Rust for Linux社区中也没有找到好的实现。只能自己做。</p>
<h3 id="如何抽象函数指针"><a href="#如何抽象函数指针" class="headerlink" title="如何抽象函数指针"></a>如何抽象函数指针</h3><p>比如，在uart_port中有很多void*类型的函数指针，如何对这些函数指针进行良好的Rust抽象就成了一大问题。</p>
<p>我在R4L的代码中找到的解决方案是</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ops</span> &#123;</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span>* <span class="title">print_int</span><span class="params">(<span class="keyword">int</span>)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">void</span>* <span class="title">print_char</span><span class="params">(<span class="keyword">char</span>)</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以上代码可以通过Rust进行如下封装</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">struct</span> <span class="title">OperationsVtable</span></span>&lt;T&gt;(marker::PhantomData&lt;T&gt;);</span><br><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">trait</span> <span class="title">Ops</span></span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">print_int</span></span>(x: <span class="built_in">i32</span>);</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">print_char</span></span>(x: <span class="built_in">char</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">impl</span>&lt;T: Ops&gt; OperationsVtable&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">unsafe</span> <span class="keyword">extern</span> <span class="string">"C"</span> <span class="function"><span class="keyword">fn</span> <span class="title">print_int</span></span>(x: c_int) &#123;</span><br><span class="line">        T::print_int(x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">unsafe</span> <span class="keyword">extern</span> <span class="string">"C"</span> <span class="function"><span class="keyword">fn</span> <span class="title">print_char</span></span>(x: c_char) &#123;</span><br><span class="line">        T::print_char(x);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> VTABLE: bindings::ops = bindings::ops &#123;</span><br><span class="line">        print_int: <span class="literal">Some</span>(Self::print_int),</span><br><span class="line">        print_char: <span class="literal">Some</span>(Self::print_char)</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">pub</span>(<span class="keyword">crate</span>) <span class="keyword">unsafe</span> <span class="function"><span class="keyword">fn</span> <span class="title">build</span></span>() -&gt; *<span class="keyword">const</span> bindings::ops &#123;</span><br><span class="line">        &amp;Self::VTABLE <span class="keyword">as</span> *<span class="keyword">const</span> _</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在定义了上面三段后就可以定义一个自己的Ops</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">MyOps</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> Ops <span class="keyword">for</span> MyOps &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 之后想要得到MyOps的对应的C的ops结构体只需要</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> ops = OperationsVtable&lt;MyOps&gt;::build();</span><br></pre></td></tr></table></figure>


<h2 id="现在的成果和收获"><a href="#现在的成果和收获" class="headerlink" title="现在的成果和收获"></a>现在的成果和收获</h2><p>对Linux的C代码中的serial_core.h中的uart_driver和uart_port以及console做了比较完整的抽象。</p>
<p>我也能够比较好的使用Rust中的Pin使数据固定在内存上的某个地方了。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://rcore-os.github.io/blog/2024/06/29/2024%E6%98%A5%E5%BC%80%E6%BA%90%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AE%AD%E7%BB%83%E8%90%A5%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5%E9%A1%B9%E7%9B%AE%E4%B8%80%E6%80%BB%E7%BB%93%E6%8A%A5%E5%91%8A--%E7%AC%A6%E4%BF%8A%E6%9D%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="rcore-os Group">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="rcore-os Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2024/06/29/2024%E6%98%A5%E5%BC%80%E6%BA%90%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AE%AD%E7%BB%83%E8%90%A5%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5%E9%A1%B9%E7%9B%AE%E4%B8%80%E6%80%BB%E7%BB%93%E6%8A%A5%E5%91%8A--%E7%AC%A6%E4%BF%8A%E6%9D%B0/" class="post-title-link" itemprop="url">2024春开源操作系统训练营第三阶段项目一总结报告--符俊杰</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-06-29 04:17:48" itemprop="dateCreated datePublished" datetime="2024-06-29T04:17:48+00:00">2024-06-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-07-02 02:48:29" itemprop="dateModified" datetime="2024-07-02T02:48:29+00:00">2024-07-02</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/report/" itemprop="url" rel="index"><span itemprop="name">report</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="第三阶段总结"><a href="#第三阶段总结" class="headerlink" title="第三阶段总结"></a>第三阶段总结</h3><h4 id="前期实验"><a href="#前期实验" class="headerlink" title="前期实验"></a>前期实验</h4><p>第三阶段前期老师带领我们基于Arceos做了两周的实验</p>
<ul>
<li><strong>练习1：支持彩色打印 println!</strong><br>较为简单，且有多种解法，可以在项目不同的层次进行修改来支持彩色打印</li>
<li><strong>练习2：支持HashMap数据类型</strong><br>在官网找到HashMap的源码然后进行一定增删就可以实现，因为初学rust，有些高级用法很生疏，改起来有点费劲。</li>
<li><strong>练习3：为内存分配器实现新的内存算法</strong><br>我的实现比较粗暴，有些内存空隙直接不要了</li>
<li><strong>练习4：解析dtb并打印</strong><br>在crate.io中有现成的解析dtb的crate，但是需要进行一定修改才能满足任务要求</li>
<li><strong>练习5：抢占式调度算法</strong><br>这个任务比较简单，改一下<code>crates/scheduler/src/fifo.rs</code>就好了</li>
</ul>
<p>第二周的五个实验如下：</p>
<ul>
<li><strong>实验一：从外部加载应用</strong></li>
<li><strong>实验2：把应用拷贝到执行区域并执行</strong></li>
<li><strong>实验3：通过 ABI 调用 ArceOS 功能</strong></li>
<li><strong>实验4：正式在 App 中调用 ABI</strong></li>
<li><strong>实验5：支持内核和应用分离的地址空间及切换</strong></li>
</ul>
<p>对于第二周的五个实验总体来说就是把外部应用APP写入PFLASH中，然后在内核中写一个APP加载器，为APP初始好寄存器后跳转到APP执行，同时支持多地址空间以及给APP传递内核<code>API_TABLE</code>的地址。第二周让我印象深刻的是跳转到APP执行前对寄存器的初始化很重要，如果初始化不到位可能会导致运行APP的时候出现各种错误。同时实验4也让我学到了如何以通过传参的方式支持APP调用内核API。</p>
<p>之后就是进入真正的项目阶段了，项目阶段是在lkmodel上开发，lkmodel相比Arceos我个人感觉难度还是有一定提升，且前两周刚熟悉完Arceos的代码和模块（T_T），一开始还是挺畏难的。不过最后在做的过程中慢慢熟悉lkmodel后也就不那么害怕了。</p>
<h4 id="进入真正的项目阶段"><a href="#进入真正的项目阶段" class="headerlink" title="进入真正的项目阶段"></a>进入真正的项目阶段</h4><h5 id="musl入手"><a href="#musl入手" class="headerlink" title="musl入手"></a>musl入手</h5><p>由于musl编译出来的app系统调用要比glibc简单的多且少得多，因此我先尝试支持用musl-gcc编译的hello_world程序。<br>经历大概如下：</p>
<ul>
<li>支持加载hello_world.bin程序并执行</li>
<li>支持对elf的解析</li>
<li>支持对hello_world.elf程序的执行</li>
</ul>
<h4 id="支持glibc"><a href="#支持glibc" class="headerlink" title="支持glibc"></a>支持glibc</h4><p>要支持glibc要实现和空实现一些syscall，让我印象比较深的是writev_syscall<br>原本lkmodel的writev_syscall实现如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">pub fn writev(fd: usize, iov_array: &amp;[iovec]) -&gt; usize &#123;</span><br><span class="line">    assert!(fd &#x3D;&#x3D; 1 || fd &#x3D;&#x3D; 2);</span><br><span class="line">    for iov in iov_array &#123;</span><br><span class="line">        debug!(&quot;iov: &#123;:#X&#125; &#123;:#X&#125;&quot;, iov.iov_base, iov.iov_len);</span><br><span class="line">        let bytes &#x3D; unsafe &#123; core::slice::from_raw_parts(iov.iov_base as *const _, iov.iov_len) &#125;;</span><br><span class="line">        let s &#x3D; String::from_utf8(bytes.into());</span><br><span class="line">        error!(&quot;&#123;&#125;&quot;, s.unwrap());</span><br><span class="line">    &#125;</span><br><span class="line">    iov_array.len()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>但是运行的时候发现没有输出，于是我简单的在writev里面加了一个<code>early_console::write_bytes(bytes);</code>。但发现输出的时候遇到了奇怪的现象，例如输出一个<code>Hello_world</code>，他会进行多次输出，并且输出的字符个数逐渐减少。如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">修改后：</span><br></pre></td></tr></table></figure>
<p>pub fn writev(fd: usize, iov_array: &amp;[iovec]) -&gt; usize {<br>    assert!(fd == 1 || fd == 2);<br>    let mut total_bytes_written = 0;<br>    for iov in iov_array {<br>        //debug!(“iov: {:#X} {:#X}”, iov.iov_base, iov.iov_len);<br>        let bytes = unsafe { core::slice::from_raw_parts(iov.iov_base as *const _, iov.iov_len) };<br>        let s = String::from_utf8(bytes.into());<br>        early_console::write_bytes(bytes);<br>        total_bytes_written += iov.iov_len;<br>    }<br>    total_bytes_written<br>}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### 发现的问题及解决思路</span><br><span class="line">1. 在支持glibc的时候由于glibc调用了一些task相关的syscall，需要拿到当前的task_sched_info，但是每次都拿不到（None），就很奇怪，明明也进行了task::init()，为什么拿不到呢？后面一直跟踪拿task_sched_info的源码才发现是通过读gp寄存器拿的，即项目中的&#96;&#96;&#96;pub fn gen_read_current_raw(symbol: &amp;Ident, ty: &amp;Type) -&gt; proc_macro2::TokenStream &#96;&#96;&#96;存也是把task_sched_info的地址存在gp寄存器上&#96;&#96;&#96;pub fn gen_write_current_raw(symbol: &amp;Ident, val: &amp;Ident, ty: &amp;Type) -&gt; proc_macro2::TokenStream &#96;&#96;&#96;。然后我就怀疑gp寄存器在app运行时被改变了，于是查看qemu.log，果然一开始就动了gp寄存器。于是我采用一个全局静态变量来存当前的task_sched_info，这样就可以顺利拿到了。</span><br><span class="line">2. 一开始没有清理.bss，导致运行时各种奇怪的问题。其实一开始没清理.bss是因为我在做payload的时候是创建了一个32M的空文件（全0），然后把app.elf文件写进去，我心想写的时候是全0，我就不用清理了吧，但在debug的时候发现利用lkmodel下的elf crate来对app.elf进行解析的时候竟然把.bss那块儿区域写了一些数据，就因为偷了个懒，导致又浪费一大把时间debug。</span><br><span class="line">3. 在支持vfork时，vfork的子进程由于要copy父进程的进入trap_handler时的寄存器信息以正确返回。在子进程返回时发现其trap上下文的sepc寄存器一直是0，且其他寄存器的值也不正常，经过调试发现是copy父进程的trap上下文时出现了问题，最后发现问题如下：</span><br><span class="line">pt_regs_addr()函数（即拿到trap上下地址的函数）原来是</span><br></pre></td></tr></table></figure>
<pre><code>pub fn pt_regs_addr(&amp;self) -&gt; usize {
    self.kstack.as_ref().unwrap().top() - align_down(TRAPFRAME_SIZE, STACK_ALIGN)
}</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">但是由于align_down导致减去的值不是TRAPFRAME_SIZE</span><br><span class="line">但在汇编中却是用self.kstack.as_ref().unwrap().top() 直接减去TRAPFRAME_SIZE</span><br><span class="line">如下：</span><br></pre></td></tr></table></figure>
<p>.Ltrap_entry_s:<br>    addi    sp, sp, -{trapframe_size}<br>    SAVE_REGS 0<br>    mv      a0, sp<br>    auipc   a1, 0          # Load the upper 20 bits of the PC into a1<br>    addi    a1, a1, 12<br>    call    riscv_trap_handler<br>    RESTORE_REGS 0<br>    sret</p>
<p>.Ltrap_entry_u:<br>    addi    sp, sp, -{trapframe_size}<br>    SAVE_REGS 1<br>    mv      a0, sp<br>    li      a1, 1<br>    call    riscv_trap_handler<br>    addi    t0, sp, {trapframe_size}    // put supervisor sp to scratch<br>    csrw    sscratch, t0<br>    RESTORE_REGS 1<br>    sret</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">因此在rust中是用pt_regs_addr()获取trap_frame地址然后进行读写操作是和汇编里面的存储位置不匹配。</span><br><span class="line">4. 不知道是不是因为静态链接的原因，我这边argc,argv,env在栈上的排布和ppt不一样，用ppt的方式排布app拿不到argv</span><br><span class="line">下面是我在其他地方看到的另一种排布方式，用此方式排布app可以正确拿到argv参数</span><br></pre></td></tr></table></figure>
<h2 id="高地址"><a href="#高地址" class="headerlink" title="高地址"></a>高地址</h2><p>  0<br>  …<br>  envp[1]<br>  envp[0]<br>  0<br>  …<br>  argv[1]<br>  argv[0]<br>  argc<br>–<br>低地址</p>
<p>```</p>
<ol start="5">
<li>由于要支持多地址空间，因此我需要给每个app重新分配一个页表，并在这个基础上为app分配内存。同时我为了复用lkmodel下的代码，我采用<code>user_mode_thread</code>来创建一个新的进程，因此我需要对<code>user_mode_thread</code>代码进行修改，最重要的是修改地址空间那块，我需要为app准备一个新的地址空间，而不是和内核共享同一个地址空间。于是我考虑更改mm_copy模块，但后面想到不能直接改这里，因为mm_copy这个函数会被多个模块调用，我改了可能其他模块就跑不通了。于是我决定在<code>user_mode_thread</code>外面为app的task.mm重新赋值（即建立新的地址空间），但神奇的事情发生了，赋值后会导致内核的页表（即之前task.mm指向的区域）被回收（Arc指针计数并不为0），之后为了验证是否是我修改了其他模块导致该问题，于是我重新git clone下来了原仓库并在原仓库基础上进行测试，发现还是会出现相同的问题。最后我通过其他手段绕过了该问题。<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4>这一个月的项目实习使我debug能力又有了提升同时更加深刻的理解了musl-gcc,glib-gcc的区别，同时也更加深刻的了解了Unikernel。同时也跟同学老师们学到了很多东西。</li>
</ol>
<h4 id="仓库链接"><a href="#仓库链接" class="headerlink" title="仓库链接"></a>仓库链接</h4><p><a href="https://github.com/xhyf77/lkmodel/tree/dev" target="_blank" rel="noopener">https://github.com/xhyf77/lkmodel/tree/dev</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://rcore-os.github.io/blog/2024/06/28/2024%E6%98%A5%E5%A4%8F%E5%AD%A3%E5%BC%80%E6%BA%90%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AE%AD%E7%BB%83%E8%90%A53%E9%98%B6%E6%AE%B5%E6%80%BB%E7%BB%93-xuejianxinokok/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="rcore-os Group">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="rcore-os Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2024/06/28/2024%E6%98%A5%E5%A4%8F%E5%AD%A3%E5%BC%80%E6%BA%90%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AE%AD%E7%BB%83%E8%90%A53%E9%98%B6%E6%AE%B5%E6%80%BB%E7%BB%93-xuejianxinokok/" class="post-title-link" itemprop="url">2024春夏季开源操作系统训练营3阶段总结-xuejianxinokok</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-06-28 11:17:04" itemprop="dateCreated datePublished" datetime="2024-06-28T11:17:04+00:00">2024-06-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-07-02 02:48:29" itemprop="dateModified" datetime="2024-07-02T02:48:29+00:00">2024-07-02</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><a href="https://gitee.com/xuejianxinokok/mysqldoc/blob/master/rust/arcos%E9%97%AE%E9%A2%98.md#arceos-lkmodel-%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90" target="_blank" rel="noopener">请转到:2024春夏季开源操作系统训练营3阶段总结-xuejianxinokok</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://rcore-os.github.io/blog/2024/06/01/2024%E6%98%A5%E5%AD%A3%E5%BC%80%E6%BA%90%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AE%AD%E7%BB%83%E8%90%A5%E7%AC%AC%E4%B8%80%E9%98%B6%E6%AE%B5%E6%80%BB%E7%BB%93%E6%8A%A5%E5%91%8A-charain/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="rcore-os Group">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="rcore-os Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2024/06/01/2024%E6%98%A5%E5%AD%A3%E5%BC%80%E6%BA%90%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AE%AD%E7%BB%83%E8%90%A5%E7%AC%AC%E4%B8%80%E9%98%B6%E6%AE%B5%E6%80%BB%E7%BB%93%E6%8A%A5%E5%91%8A-charain/" class="post-title-link" itemprop="url">2024春季开源操作系统训练营第一阶段总结报告-charain</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-06-01 20:12:36" itemprop="dateCreated datePublished" datetime="2024-06-01T20:12:36+00:00">2024-06-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-07-02 02:48:29" itemprop="dateModified" datetime="2024-07-02T02:48:29+00:00">2024-07-02</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <a id="more"></a>

<p><del>报告编写时间好像有点晚</del></p>
<h2 id="第一阶段总结报告"><a href="#第一阶段总结报告" class="headerlink" title="第一阶段总结报告"></a>第一阶段总结报告</h2><p>大概是寒假的时候，在网络上寻找一些学习操作系统的资料时，接触到了rcore lab和这个训练营，然后看到有一起学习的群友报名了这个训练营之后，立马顺着链接跟过来了。</p>
<p>在此之前并没有编写过类似的操作系统，了解学习过一些操作系统的知识，而且也对rust不是很熟悉。</p>
<h3 id="rust语言"><a href="#rust语言" class="headerlink" title="rust语言"></a>rust语言</h3><p>在参加这个训练营之前，是尝试学习过rust的，当时rust吸引我的原因不是因为它在内存安全方面的独特特性，而是它是一门现代的，系统级编程语言。而我确实也需要这样的语言(尝试为c语言寻找更加现代的替代)。不过当时由于rust特有的难以入门的特性和陡峭的学习曲线，随后便暂时放弃了这个语言的学习。</p>
<p>在参加了这个训练营之后，重新捡起来rust语言，发现也并不是想象中的那么可怕，其语言特性的设计理念，也可以理解。而且从这里，也进一步的体验到了其作为一门现代语言的好处。例如包管理器(安装新的工具链太方便啦)，更好的lsp服务器(感觉比clangd强)，以及语言提供的恰到好处的抽象设计，都让人感到很舒心。而且作为一门系统级语言，也很方便的可以在之后帮助我编写运行在一些裸机上的应用程序。</p>
<h3 id="rustlings"><a href="#rustlings" class="headerlink" title="rustlings"></a>rustlings</h3><p>这个练习前半部分基本都是和语言特性相关的内容，做起来还是很迅速的，基本上没有花费很长的时间便完成了这一部分的内容。但是对于后面的算法题部分，便开始困难起来了。倒不是这些数据结构和算法不清楚，如果使用c语言实现它们，那么将易如反掌，但是对于自己不熟悉，且时时刻刻强调内存安全的rust语言而言，便显得很困难。好在在查阅资料和不断的尝试下，还是将这一部分内容给完成了。</p>
<h2 id="第二阶段总结报告"><a href="#第二阶段总结报告" class="headerlink" title="第二阶段总结报告"></a>第二阶段总结报告</h2><p>第二阶段的前三个实验，基本上是连着几天完成的，最后两个实验拖慢了几天。</p>
<p>总的来说，对于这一部分，还是学到了很多知识。</p>
<p>首先说一说riscv方面吧，对于这一方面相对更加熟悉，之前也编写过riscv的处理器和模拟器，并且也使用c语言编写过裸机应用，对于riscv相关的知识方面，还是很顺滑的便掌握了。</p>
<p>对于rust语言，写到这个阶段已经比第一阶段顺手多了，不过在使用这个语言时使用的很多设计理念，例如资源获取即初始化，等等设计方面的考量，还是学习到了很多。或许在完成这一部分内容之后，可以试着使用rust去重构之前写过的一些c语言项目了(乐)。</p>
<p>随后是对于操作系统相关的知识，之前学习过一些操作系统的概念和知识，但是对于真正的将操作系统实现出来，还是第一次尝试做出来。以前学习操作系统时还尝试看过一些linux内核设计相关的书籍，最后的结果是看的比较稀里糊涂。通过这次操作系统设计之后，或许之后入门linux能够更加顺利一些。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://rcore-os.github.io/blog/2024/05/31/2024%E5%BC%80%E6%BA%90%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AE%AD%E7%BB%83%E8%90%A5%E7%AC%AC%E4%B8%80%E9%98%B6%E6%AE%B5%E6%80%BB%E7%BB%93-qiuanran/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="rcore-os Group">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="rcore-os Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2024/05/31/2024%E5%BC%80%E6%BA%90%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AE%AD%E7%BB%83%E8%90%A5%E7%AC%AC%E4%B8%80%E9%98%B6%E6%AE%B5%E6%80%BB%E7%BB%93-qiuanran/" class="post-title-link" itemprop="url">2024春夏季训练营第一阶段总结-qiuanran</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-05-31 01:17:02" itemprop="dateCreated datePublished" datetime="2024-05-31T01:17:02+00:00">2024-05-31</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-07-02 02:48:29" itemprop="dateModified" datetime="2024-07-02T02:48:29+00:00">2024-07-02</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>在去年秋天听闻了这个训练营，机缘巧合之下结识了Rust和rcore。 也许是由于rust这门语言入门门槛比较高，加之当时没有其他更modern语言的学习经验，只做完Rustlings就已经打算放弃了。从去年秋天到现在一直在写Rust,也了解了许多系统方面的知识，就打算在这次训练营中弥补一些遗憾。</p>
<h2 id="第一阶段"><a href="#第一阶段" class="headerlink" title="第一阶段"></a>第一阶段</h2><h3 id="心得"><a href="#心得" class="headerlink" title="心得"></a>心得</h3><p>第一阶段更多的是教初学者通过查手册、book或者是问AI来逐渐了解Rust的各种特性，如所有权机制（一个value只能对应一个所有者）、RAII机制（自动回收）、智能指针（个人认为智能指针的学习更多的应该落实于应用场景：即它为什么而存在的问题）、生命周期（我认为它的存在更多的是帮助编译器编译）等，这些是Rust比较有意思的机制，也是大大保障了代码安全性的由来。</p>
<h3 id="体验"><a href="#体验" class="headerlink" title="体验"></a>体验</h3><p>有了去年以来一直积累的Rust经验，做Rustlings倒是非常快了。最后出的十道算法题非常有意思，大大加深了我对于智能指针的认识，虽然都是入门的算法题倒算是个很新奇的体验。</p>
<h3 id="资料"><a href="#资料" class="headerlink" title="资料"></a>资料</h3><p><a href="https://github.com/LearningOS/rust-based-os-comp2024/blob/main/2024-spring-scheduling-1.md" target="_blank" rel="noopener">由训练营给出的学习资料</a>，同时也推荐Stanford的CS110L。 </p>
<h2 id="第二阶段"><a href="#第二阶段" class="headerlink" title="第二阶段"></a>第二阶段</h2><h3 id="学习过程"><a href="#学习过程" class="headerlink" title="学习过程"></a>学习过程</h3><p>rcore这个类Unix内核对于了解各种OS的各种核心内容而言是非常有帮助的，实际上，若不是有了Rust的一些经验，很难理清由理论转换为具体实现的过程。</p>
<p>对于rcore的学习，刚开始我十分痛苦，看着后面的实验要求一时间无计可施，只能由各种已经实现的syscall一个个去trace他们的调用关系，才有了一点点的大致思路。但具体实现起来又有其他的问题，这时候我的目光就放在了具体的数据结构上，需要彻底弄明白每一个数据结构的具体功能、与其他数据结构的关联，才能够说很好的掌握了整个流程。</p>
<h3 id="rcore总结"><a href="#rcore总结" class="headerlink" title="rcore总结"></a>rcore总结</h3><ul>
<li>Chapter1-2：需要关注于环境如何一步步搭建，如何切换特权级</li>
<li>Chapter3：难点在于理解任务切换时候的流程：trap上下文的保存。应用在内核中处理时， 其 Trap 控制流调用__switch函数，这个函数非常重要，里面就是任务的上下文寄存器。</li>
<li>Chapter4：对于我而言，虚拟内存几乎是最难的一个章节了，以至于看到实验要求的时候说注意数据被切分成两个不同的页表中时我甚至不知道它想表达什么，反复观看、查找资料之后才能艰难完成。</li>
<li>Chapter5：关键在于理解有关进程的每一个数据结构，以及它的调度机制，重点需要弄明白suspend_current_and_run_next这个函数以及整个task的工作流程：take_current_task 来取出当前正在执行的任务，修改其进程控制块内的状态变成Running，随后将这个任务放入任务管理器的队尾。接着调用 schedule 函数来触发调度并切换任务。</li>
<li>Chapter6：文件系统相比起前面的章节有些异常庞大了，需要抓住核心抽象以及它的层次结构。</li>
<li>Chapter7：了解进程之间如何通信，关注于各种不同的通信方式。</li>
<li>Chapter8：并发是OS绕不开的一个话题，掌握各种锁+线程的概念对于理解并发有奇效，但其实Rust的很受欢迎的异步并发并没有提及，想来是语言特性而不属于OS教学层面上的。推荐一个了解Rust异步并发非常好的读物：<a href="https://tokio.rs/tokio/tutorial/async" target="_blank" rel="noopener">Async in depth | Tokio - An asynchronous Rust runtime</a></li>
</ul>
<h3 id="一些心得"><a href="#一些心得" class="headerlink" title="一些心得"></a>一些心得</h3><p>我觉得最重要的，也是支撑我艰难走过rcore这道难关的就是一个观念，在南京大学的OS课程上反复强调的：操作系统就是一个应用程序。这也是我在进行每一个lab后最大的感触。在接管了trap之后，所有的一切都是逻辑上的开发，与不同的应用程序没有什么区别。</p>
<h3 id="资料-1"><a href="#资料-1" class="headerlink" title="资料"></a>资料</h3><ul>
<li>南京大学OS课程</li>
<li>MIT6.S081: xv6 book</li>
<li>CSAPP</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/blog/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/blog/">1</a><span class="page-number current">2</span><a class="page-number" href="/blog/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/blog/page/41/">41</a><a class="extend next" rel="next" href="/blog/page/3/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



        </div>
        

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">rcore-os Group</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/blog/lib/anime.min.js"></script>

<script src="/blog/js/utils.js"></script>

<script src="/blog/js/motion.js"></script>


<script src="/blog/js/schemes/muse.js"></script>


<script src="/blog/js/next-boot.js"></script>


  















  

  

  

</body>
</html>
